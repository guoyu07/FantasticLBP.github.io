<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>杭城小刘</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-10-13T08:29:24.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>杭城小刘</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>HyBrid探索（一）</title>
    <link href="http://yoursite.com/2017/10/13/HyBrid%E6%8E%A2%E7%B4%A2%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://yoursite.com/2017/10/13/HyBrid探索（一）/</id>
    <published>2017-10-13T07:50:05.000Z</published>
    <updated>2017-10-13T08:29:24.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="UIWebView加载网页内容"><a href="#UIWebView加载网页内容" class="headerlink" title="UIWebView加载网页内容"></a>UIWebView加载网页内容</h4><p>可以通过本地文件、url等方式。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSString *htmlPath = [[NSBundle mainBundle] pathForResource:@&quot;index&quot; ofType:@&quot;html&quot;];</div><div class="line">NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL fileURLWithPath:htmlPath]];</div><div class="line">[self.webView loadRequest:request];</div></pre></td></tr></table></figure><h4 id="Native调用JavaScript"><a href="#Native调用JavaScript" class="headerlink" title="Native调用JavaScript"></a>Native调用JavaScript</h4><p>Native调用JS是通过UIWebView的stringByEvaluatingJavaScriptFromString 方法实现的，该方法返回js脚本的执行结果。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[webView stringByEvaluatingJavaScriptFromString:@&quot;Math.random();&quot;];</div></pre></td></tr></table></figure><p>实际上就是调用了网页的Window下的一个对象。如果我们需要让native端调用js方法，那么这个js方法必须在window下可以访问到。</p><h4 id="JavaScript调用Native"><a href="#JavaScript调用Native" class="headerlink" title="JavaScript调用Native"></a>JavaScript调用Native</h4><p>反过来，JavaScript调用Native，并没有现成的API可以调用，而是间接地通过一些其它手段来实现。UIWebView有个代理方法：在UIWebView内发起的任何网络请求都可以通过delegate函数在Native层得到通知。由此思路，我们就可以在UIWebView内发起一个自定义的网络请求，通常是这样的格式：<strong>jsbridge://methodName?param1=value1&amp;param2=value2…</strong></p><p>在UIWebView的delegate函数中，我们判断请求的scheme，如果request.URL.scheme是jsbridge，那么就不进行网页内容的加载，而是去执行相应的方法。方法名称就是request.URL.host。参数可以通过request.URL.query得到。</p><p>问题来了？？</p><p>发起这样1个网络请求有2种方式。1:location.href .2：iframe。通过location.href有个问题，就是如果js多次调用原生的方法也就是location.href的值多次变化，Native端只能接受到最后一次请求，前面的请求会被忽略掉。</p><p>使用ifrmae方式，以调用Native端的方法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var iFrame;</div><div class="line">iFrame = document.createElement(&quot;iframe&quot;);</div><div class="line">iFrame.style.height = &quot;1px&quot;;</div><div class="line">iFrame.style.width = &quot;1px&quot;;</div><div class="line">iFrame.style.display = &quot;none&quot;;</div><div class="line">iFrame.src = url;</div><div class="line">document.body.appendChild(iFrame);</div><div class="line">setTimeout(function()&#123;</div><div class="line">iFrame.remove();</div><div class="line">&#125;,100);</div></pre></td></tr></table></figure><p>举个🌰：</p><p>需求：</p><p>原生端提供一个UIWebView，加载一个网页内容。还有1个按钮，按钮点击一下网页增加一段段落文本。网页上有2个输入框，用户输入数字，点击按钮，js将用户输入的参数告诉native端，native去执行加法，计算完成后将结果返回给js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">//index.html</div><div class="line"></div><div class="line"></div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf8&quot;&gt;</div><div class="line">&lt;script language=&quot;javascript&quot;&gt;</div><div class="line">function loadURL(url)&#123;</div><div class="line">var iFrame;</div><div class="line">iFrame = document.createElement(&quot;iframe&quot;);</div><div class="line">iFrame.style.height = &quot;1px&quot;;</div><div class="line">iFrame.style.width = &quot;1px&quot;;</div><div class="line">iFrame.style.display = &quot;none&quot;;</div><div class="line">iFrame.src = url;</div><div class="line">document.body.appendChild(iFrame);</div><div class="line">setTimeout(function()&#123;</div><div class="line">iFrame.remove();</div><div class="line">&#125;,100);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">function receiveValue(value)&#123;</div><div class="line">alert(&quot;从原生拿到加法结果为：&quot;+value);</div><div class="line">&#125;</div><div class="line"></div><div class="line">function check() &#123;</div><div class="line">var par1 = document.getElementById(&quot;par1&quot;).value;</div><div class="line">var par2 = document.getElementById(&quot;par2&quot;).value;</div><div class="line">loadURL(&quot;JSBridge://plus?par1=&quot; + par1 +&quot;&amp;par2=&quot; + par2);</div><div class="line">&#125;</div><div class="line"></div><div class="line">&lt;/script&gt;</div><div class="line">&lt;/head&gt;</div><div class="line"></div><div class="line">&lt;body&gt;</div><div class="line">&lt;input type=&quot;text&quot; placeholder=&quot;请输入数字&quot;  id=&quot;par1&quot;／&gt; + &lt;input type=&quot;text&quot; placeholder=&quot;请输入数字&quot;  id=&quot;par2&quot;／&gt;</div><div class="line">&lt;input type=&quot;button&quot; value=&quot;=&quot; onclick=&quot;check()&quot; /&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">//ViewController.m</div><div class="line"></div><div class="line">-(void)addContentToWebView&#123;</div><div class="line">NSString *jsString = @&quot; var pNode = document.createElement(\&quot;p\&quot;); pNode.innerText = \&quot;我是由原生代码调用js后将一段文件添加到html上，也就是注入\&quot;;document.body.appendChild(pNode);&quot;;</div><div class="line">[self.webView stringByEvaluatingJavaScriptFromString:jsString];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">-(NSInteger)plusparm:(NSInteger)par1 parm2:(NSInteger)par2&#123;</div><div class="line">return par1 + par2;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">#pragma mark -- UIWebViewDelegate</div><div class="line">- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType&#123;</div><div class="line">NSURL *url = request.URL;</div><div class="line">NSString *scheme = url.scheme;</div><div class="line">NSString *method = url.host;</div><div class="line">NSString *parms =  url.query;</div><div class="line">NSArray *pars = [parms componentsSeparatedByString:@&quot;&amp;&quot;];</div><div class="line">NSInteger par1 = [[pars[0] substringFromIndex:5] integerValue];</div><div class="line">NSInteger par2 = [[pars[1] substringFromIndex:5] integerValue];</div><div class="line">if ([scheme isEqualToString:@&quot;jsbridge&quot;]) &#123;</div><div class="line">//发现scheme是JSBridge，那么就是自定义的URLscheme，不去加载网页内容而拦截去处理事件。</div><div class="line"></div><div class="line">if ([method isEqualToString:@&quot;plus&quot;]) &#123;</div><div class="line">NSInteger result = [self plusparm:par1 parm2:par2];</div><div class="line">[self.webView stringByEvaluatingJavaScriptFromString:[NSString stringWithFormat:@&quot;receiveValue(%@);&quot;,@(result)]];</div><div class="line">&#125;</div><div class="line"></div><div class="line">return NO;</div><div class="line">&#125;</div><div class="line">return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="同步和异步问题"><a href="#同步和异步问题" class="headerlink" title="同步和异步问题"></a>同步和异步问题</h4><p>js调用native是通过在一个网页上插入一个iframe，这个iframe插入完了就完了，执行的结果需要native另外调用stringByEvaluatingJavaScriptString 方法通知js。这明显是1个异步的调用。而stringByEvaluatingJavaScriptString方法会返回执行js脚本的结果。本质上是一个同步调用</p><p>所以js call native是异步，native call js是同步。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;UIWebView加载网页内容&quot;&gt;&lt;a href=&quot;#UIWebView加载网页内容&quot; class=&quot;headerlink&quot; title=&quot;UIWebView加载网页内容&quot;&gt;&lt;/a&gt;UIWebView加载网页内容&lt;/h4&gt;&lt;p&gt;可以通过本地文件、url等方式。&lt;/
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>事件响应者链条</title>
    <link href="http://yoursite.com/2017/10/13/%E4%BA%8B%E4%BB%B6%E5%93%8D%E5%BA%94%E8%80%85%E9%93%BE%E6%9D%A1/"/>
    <id>http://yoursite.com/2017/10/13/事件响应者链条/</id>
    <published>2017-10-13T03:15:00.000Z</published>
    <updated>2017-10-13T08:53:05.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>hitTest和pointInside方法你真的熟吗？</title>
    <link href="http://yoursite.com/2017/10/12/hitTest%E5%92%8CpointInside%E6%96%B9%E6%B3%95%E4%BD%A0%E7%9C%9F%E7%9A%84%E7%86%9F%E5%90%97%EF%BC%9F/"/>
    <id>http://yoursite.com/2017/10/12/hitTest和pointInside方法你真的熟吗？/</id>
    <published>2017-10-12T02:51:32.000Z</published>
    <updated>2017-10-12T02:52:53.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="hittest方法"><a href="#hittest方法" class="headerlink" title="hittest方法"></a>hittest方法</h3><ul><li>就是用来寻找最合适的view</li><li>当一个事件传递给一个控件，就会调用这个控件的hitTest方法</li><li>点击了白色的view： 触摸事件 -&gt; UIApplication -&gt; UIWindow 调用 [UIWindow hitTest] -&gt; 白色view [WhteView hitTest]</li></ul><p>实验1:</p><p>定义 BaseView，在里面实现方法touchBegan，监听当前哪个类调用了该方法。</p><p>定义KeyWindow，在里面实现hitTest方法，监听哪个类调用了该方法，用来追踪判断哪个view是最合适的view</p><p>在控制器的界面上加5个颜色不同的view，每个view自定义view去实现，因此在不同的view上的手势就可以由不同的view拦截到。</p><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/Simulator%20Screen%20Shot%20-%20iPhone%206s%20Plus%20-%202017-10-11%20at%2010.14.37.png" alt="UI效果图"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//KeyWindow</div><div class="line"></div><div class="line">-(UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event&#123;</div><div class="line">UIView *view = [super hitTest:point withEvent:event];</div><div class="line">NSLog(@&quot;fittest-&gt;%@&quot;,view);</div><div class="line">return view;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>结果：</p><p>点击了白色1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">2017-10-11 16:48:52.882547+0800 主流App框架[16295:358790] BrownView--hitTest withEvent</div><div class="line">2017-10-11 16:48:59.646610+0800 主流App框架[16295:358790] GreenView--hitTest withEvent</div><div class="line">2017-10-11 16:48:59.647145+0800 主流App框架[16295:358790] fittest-&gt;&lt;UIView: 0x7f8f23406510; frame = (0 0; 414 736); autoresize = W+H; layer = &lt;CALayer: 0x60c000221840&gt;&gt;</div><div class="line">2017-10-11 16:48:59.647575+0800 主流App框架[16295:358790] BrownView--hitTest withEvent</div><div class="line">2017-10-11 16:48:59.647702+0800 主流App框架[16295:358790] GreenView--hitTest withEvent</div><div class="line">2017-10-11 16:48:59.647880+0800 主流App框架[16295:358790] fittest-&gt;&lt;UIView: 0x7f8f23406510; frame = (0 0; 414 736); autoresize = W+H; layer = &lt;CALayer: 0x60c000221840&gt;&gt;</div></pre></td></tr></table></figure><p>点击了蓝色3:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">2017-10-11 16:49:56.331024+0800 主流App框架[16295:358790] BrownView--hitTest withEvent</div><div class="line">2017-10-11 16:49:56.331335+0800 主流App框架[16295:358790] BView--hitTest withEvent</div><div class="line">2017-10-11 16:49:56.331617+0800 主流App框架[16295:358790] BlueView--hitTest withEvent</div><div class="line">2017-10-11 16:49:56.331968+0800 主流App框架[16295:358790] YellowView--hitTest withEvent</div><div class="line">2017-10-11 16:49:56.333206+0800 主流App框架[16295:358790] fittest-&gt;&lt;BlueView: 0x7f8f23406f10; frame = (19 21; 240 128); autoresize = RM+BM; layer = &lt;CALayer: 0x60c0002218c0&gt;&gt;</div><div class="line">2017-10-11 16:49:56.333633+0800 主流App框架[16295:358790] BrownView--hitTest withEvent</div><div class="line">2017-10-11 16:49:56.333762+0800 主流App框架[16295:358790] BView--hitTest withEvent</div><div class="line">2017-10-11 16:49:56.333893+0800 主流App框架[16295:358790] BlueView--hitTest withEvent</div><div class="line">2017-10-11 16:49:56.334005+0800 主流App框架[16295:358790] YellowView--hitTest withEvent</div><div class="line">2017-10-11 16:49:56.334185+0800 主流App框架[16295:358790] fittest-&gt;&lt;BlueView: 0x7f8f23406f10; frame = (19 21; 240 128); autoresize = RM+BM; layer = &lt;CALayer: 0x60c0002218c0&gt;&gt;</div><div class="line">2017-10-11 16:49:56.334644+0800 主流App框架[16295:358790] BlueView</div></pre></td></tr></table></figure><p>那么看出来hitTest方法的作用就是找出最合适的view，那么我们可以指定任何事情的最合适的view为特定的view</p><p>实验2:</p><p>在KeyWindow中hitTest方法中返回BlueView，那么点击任何色块的view那么都会交给BlueView去处理事件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//KeyWindow</div><div class="line">-(UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event&#123;</div><div class="line">return self.subviews.firstObject.subviews.firstObject;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2017-10-11 22:48:46.102793+0800 主流App框架[21498:749663] GreenView</div><div class="line">2017-10-11 22:48:46.668595+0800 主流App框架[21498:749663] GreenView</div></pre></td></tr></table></figure><p>因为事件的响应者链条就是当用户操作屏幕会产生一个事件，该事件被系统加入到事件队列中去，UIApplication对象会将事件队列中最早加入进去的事件传递给window，然后window找到最合适的view去处理事件。因此任何事件都会先通过KeyWindow对象去判断并找到最合适的view</p><h2 id="2个重要的方法"><a href="#2个重要的方法" class="headerlink" title="2个重要的方法"></a>2个重要的方法</h2><ul><li><p>-(BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event： 用来判断触摸点是否在控件上</p></li><li><p>-(UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event： 用来判断控件是否接受事件以及找到最合适的view</p></li></ul><h2 id="模仿系统实现找出最合适的view"><a href="#模仿系统实现找出最合适的view" class="headerlink" title="模仿系统实现找出最合适的view"></a>模仿系统实现找出最合适的view</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">//KeyWindow</div><div class="line"></div><div class="line">/**</div><div class="line">模仿系统实现寻找最合适的view步骤</div><div class="line">1、控件接收事件</div><div class="line">2、触摸点在自己身上</div><div class="line">3、从后往前遍历子控件，重复前面2个步骤</div><div class="line">4、如果没有符合条件的子控件，那么就自己最合适</div><div class="line"></div><div class="line">*/</div><div class="line"></div><div class="line">-(UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event&#123;</div><div class="line">if (self.userInteractionEnabled == NO || self.hidden == YES || self.alpha &lt;= 0.01) &#123;</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (![self pointInside:point withEvent:event]) &#123;</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">for (NSUInteger index = self.subviews.count - 1; index &gt;= 0; index--) &#123;</div><div class="line">CGPoint childViewPoint = [self convertPoint:point toView:self.subviews[index]];</div><div class="line">UIView *fitestView = [self.subviews[index] hitTest:childViewPoint withEvent:event];</div><div class="line">if (fitestView) &#123;</div><div class="line">return fitestView;</div><div class="line">&#125;</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>给出 一个Demo地址：<a href="https://github.com/FantasticLBP/BlogDemos/tree/master/模仿系统找出事件的最佳响应者" title="模仿系统找出事件的最佳响应者" target="_blank" rel="external">https://github.com/FantasticLBP/BlogDemos/tree/master/模仿系统找出事件的最佳响应者</a></p><p>实验：</p><p>在控制器（ViewController）的view上先添加一个UIButton，再添加一个自定义的UIView(ShelterView),盖在button的上面。</p><p>需求：点击ShelterView上的点，如果点也在UIButton范围上则交给UIButton处理事件，如果不在UIButton上则交给ShelterView处理，如果点击屏幕上除了ShelterView之外的点则交给控制器的view处理。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">//ViewController</div><div class="line">-(void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123;</div><div class="line">NSLog(@&quot;viewController-&gt;%s&quot;,__func__);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">//ShelterView</div><div class="line">#import &quot;ShelterView.h&quot;</div><div class="line"></div><div class="line">@implementation ShelterView</div><div class="line"></div><div class="line">-(void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123;</div><div class="line">NSLog(@&quot;%s&quot;,__func__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event&#123;</div><div class="line">NSLog(@&quot;%s&quot;,__func__);</div><div class="line">/**</div><div class="line">需求：不管点击按钮还是view都交给button处理</div><div class="line">思路：在view的hitTest方法中寻找最合适的view，那么返回nil告诉系统view不是最合适的view，那么系统则认为按钮是最合适的view</div><div class="line">return nil;</div><div class="line">*/</div><div class="line"></div><div class="line">//需求，在view上点击，如果点击范围在button上则由button进行处理事件；否则交给view处理事件</div><div class="line"></div><div class="line">UIView *button = nil;</div><div class="line">for (UIView *subView in self.superview.subviews) &#123;</div><div class="line">//判断事件的点是否在按钮上</div><div class="line">if ([subView isKindOfClass:[UIButton class]]) &#123;</div><div class="line">button =subView;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">CGPoint btnPoint = [self convertPoint:point toView:button];</div><div class="line">if ([button pointInside:btnPoint withEvent:event]) &#123;</div><div class="line">return button;</div><div class="line">&#125;else&#123;</div><div class="line">//此时代表事件触摸点不在button上，但是也不能写nil，写nil的话点击屏幕上的其他地方系统会寻找最合适的view，此时返回nil（ return nil;），则代表view不是最合适的view,那么此时点击屏幕上除了按钮之外的区域，最合适的view就是控制器上面的view</div><div class="line">return [super hitTest:point withEvent:event];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure><p>要看完整Demo，地址为：<a href="https://github.com/FantasticLBP/BlogDemos/tree/master/hitTest的神奇效果（一）" title="hitTest的神奇效果" target="_blank" rel="external">https://github.com/FantasticLBP/BlogDemos/tree/master/hitTest的神奇效果（一）</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;hittest方法&quot;&gt;&lt;a href=&quot;#hittest方法&quot; class=&quot;headerlink&quot; title=&quot;hittest方法&quot;&gt;&lt;/a&gt;hittest方法&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;就是用来寻找最合适的view&lt;/li&gt;
&lt;li&gt;当一个事件传递给一个控件
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>事件响应者链</title>
    <link href="http://yoursite.com/2017/10/12/%E4%BA%8B%E4%BB%B6%E5%93%8D%E5%BA%94%E8%80%85%E9%93%BE/"/>
    <id>http://yoursite.com/2017/10/12/事件响应者链/</id>
    <published>2017-10-12T02:49:55.000Z</published>
    <updated>2017-10-13T08:53:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>实验1:</p><p>定义 BaseView，在里面实现方法touchBegan，监听当前哪个类调用了该方法。</p><p>在控制器的界面上加5个颜色不同的view，每个view自定义view去实现，因此在不同的view上的手势就可以由不同的view拦截到。</p><p><img src="https://github.com/FantasticLBP/iOSKonwledge-Kit/blob/master/assets/Simulator%20Screen%20Shot%20-%20iPhone%206s%20Plus%20-%202017-10-11%20at%2010.14.37.png?raw=true" alt="UI效果图"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//BaseView</div><div class="line">#import &quot;BaseView.h&quot;</div><div class="line"></div><div class="line">@implementation BaseView</div><div class="line">-(void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123;</div><div class="line">NSLog(@&quot;%@&quot;,[self class]);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>结果：点击不同的View打印出不同的类名。</p><p>结论：</p><ul><li>触摸事件是从父控件传递到子控件的。</li><li>点击了绿色（图上的2级）的view：UIApplication-&gt; UIWindow -&gt; UIViewController的view -&gt; 绿色的view</li><li>点击了蓝色（图上的3级）的view：UIApplication-&gt; UIWindow -&gt; UIViewController的view -&gt; 红棕色的view -&gt; 蓝色的view</li><li>点击了黄色（图上的4级）的view：UIApplication -&gt; UIWindow -&gt; UIViewController的view -&gt; 红棕色的view -&gt; 蓝色的view -&gt; 黄色的view</li></ul><p>注意：如果父控件不能接收触摸事件，那么这个父控件的子控件也不能接收触摸事件</p><h4 id="如何找到最合适的控件来接收触摸事件？"><a href="#如何找到最合适的控件来接收触摸事件？" class="headerlink" title="如何找到最合适的控件来接收触摸事件？"></a>如何找到最合适的控件来接收触摸事件？</h4><ul><li>自己能否接收触摸事件？</li><li>触摸点是否在自己身上？</li><li>从后往前遍历子控件，重复前面2个步骤</li><li>如果没有符合条件的子控件，那么就自己最适合处理</li></ul><h1 id="事件响应原理"><a href="#事件响应原理" class="headerlink" title="事件响应原理"></a>事件响应原理</h1><p>产生的touch方法的默认做法是将事件顺着响应者链条向上传递，将事件交给上一个响应者处理。</p><h4 id="响应者链条"><a href="#响应者链条" class="headerlink" title="响应者链条"></a>响应者链条</h4><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/响应者链条.png" alt="响应者链条"></p><h4 id="事件传递的完整过程"><a href="#事件传递的完整过程" class="headerlink" title="事件传递的完整过程"></a>事件传递的完整过程</h4><ol><li>先将事件对象由上往下传递（父控件传递给子控件），找到最合适的控件来处理</li><li>调用最合适控件的touch方法</li><li>如果调用了[super touches…]方法就会将事件顺着响应者链条向上传递，传递给上一个响应者</li><li>接着就会调用上一个响应者的touches…方法</li></ol><h4 id="事件响应者"><a href="#事件响应者" class="headerlink" title="事件响应者"></a>事件响应者</h4><h5 id="如何判断该控件的上一个响应者？"><a href="#如何判断该控件的上一个响应者？" class="headerlink" title="如何判断该控件的上一个响应者？"></a>如何判断该控件的上一个响应者？</h5><ol><li>如果当前这个view是控制器的view，那么上一个响应者就是控制器</li><li>如果当前这个view不是控制器的view，那么上一个响应者就是父控件。</li></ol><p>事件传递给UIApplication后如果不处理的话，该事件会销毁掉。</p><p>控制器view上的子控件的touch…方法如果子控件不处理那么都会顺着响应者链条向上传递给上一层响应者对象，比如可以交给控制器处理。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;实验1:&lt;/p&gt;
&lt;p&gt;定义 BaseView，在里面实现方法touchBegan，监听当前哪个类调用了该方法。&lt;/p&gt;
&lt;p&gt;在控制器的界面上加5个颜色不同的view，每个view自定义view去实现，因此在不同的view上的手势就可以由不同的view拦截到。&lt;/p&gt;
&lt;
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>iOS中的事件</title>
    <link href="http://yoursite.com/2017/10/12/iOS%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6/"/>
    <id>http://yoursite.com/2017/10/12/iOS中的事件/</id>
    <published>2017-10-12T02:48:39.000Z</published>
    <updated>2017-10-12T02:53:17.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li>用户在使用App的时候会产生各种事件</li><li>触摸事件、重力加速计事件、远程遥控事件</li><li>只有继承自UIResponder才可以响应事件</li><li>UIView、UIApplication、UIViewController都可以响应事件</li><li><h2 id="UIResponder"><a href="#UIResponder" class="headerlink" title="UIResponder"></a>UIResponder</h2></li><li>UIResponder内部提供了一些方法处理事件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//触摸事件</div><div class="line">-(void)touchBegan:(NSSet *)touches withEvent:(UIEvent *)event;</div><div class="line">-(void)touchMoved:(NSSet *)touches withEvent:(UIEvent *)event;</div><div class="line">-(void)touchEnded:(NSSet *)touches withEvent:(UIEvent *)event;</div><div class="line">-(void)touchCanceled:(NSSet *)touches withEvent:(UIEvent *)event;</div><div class="line"></div><div class="line">//加速计事件</div><div class="line">-(void)motionBegan:(UIEventSubtype)motion withEvent:(UIEvent *)event;</div><div class="line">-(void)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event;</div><div class="line">-(void)motionCanceled:(UIEventSubtype)motion withEvent:(UIEvent *)event;</div><div class="line"></div><div class="line">//远程控制事件</div><div class="line">-(void)remoteControlReceivedWithEvent:(UIEvent *)event;</div></pre></td></tr></table></figure><h1 id="事件的产生和传递"><a href="#事件的产生和传递" class="headerlink" title="事件的产生和传递"></a>事件的产生和传递</h1><ul><li>发生触摸事件后，系统会将该事件加入到一个由UIApplication管理的事件队列中去</li><li>UIApplication会从事件队列中取出最前面的事件，并将事件分发下去以便处理，通常先分发事件给应用程序的主窗口（keyWindow）</li><li>主窗口会在视图层次结构中寻找到一个最合适的视图来处理触摸事件，这也是整个事件处理过程中最重要的一步。</li></ul><p>找到合适的视图控件后，就会调用视图控件的touch方法来做具体的事件处理逻辑</p><h2 id="UIView不接收事件的3种情况"><a href="#UIView不接收事件的3种情况" class="headerlink" title="UIView不接收事件的3种情况"></a>UIView不接收事件的3种情况</h2><ol><li>不接收用户交互。view.userInteractionEnabled = NO</li><li>隐藏。view.hidden = YES</li><li>透明度很低。view.alpha = 0.0 ~ 0.01</li></ol><p>注意：UIImageView的userInteractionEnabled默认为NO，因此UIImageView及其它上面的子控件默认是不能接受触摸事件的。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;用户在使用App的时候会产生各种事件&lt;/li&gt;
&lt;li&gt;触摸事件、重力加速计事件、远程遥控事件&lt;/li&gt;
&lt;li&gt;只有继承自UIResponder才可以响应事件&lt;/li&gt;
&lt;li&gt;UIView、UIApplication、UIViewController都可以响
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>抓包工具 - Charles初见</title>
    <link href="http://yoursite.com/2017/10/10/%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7-Charles%E5%88%9D%E8%A7%81/"/>
    <id>http://yoursite.com/2017/10/10/抓包工具-Charles初见/</id>
    <published>2017-10-10T06:56:48.000Z</published>
    <updated>2017-10-10T06:58:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>一、 下载地址<br>Charles的下载地址：<a href="https://pan.baidu.com/s/1sl8bE93" target="_blank" rel="external">https://pan.baidu.com/s/1sl8bE93</a><br>因为Charles只有30天的试用期，所以在这里给一个破解版的包：<a href="https://pan.baidu.com/s/1cHtE0m" target="_blank" rel="external">https://pan.baidu.com/s/1cHtE0m</a><br>二、破解方法<br>1、像正常安装应用一样，点击安装，之后将应用包拖到Application目录中。<br>2、右击Charles.app，显示包内容，然后将第二个链接下载下来的破解包复制黏贴到此目录下替换。<br>三、使用教程<br>1、Charles上的设置。<br>    在Charles的菜单栏上选择”Proxy” -&gt; “Proxy Settings”,填入代理端口8888，并且勾选”Enable transparent HTTP proxying”,就完成了Charles上的设置，如下图所示：<br>    <img src="http://upload-images.jianshu.io/upload_images/2287777-6b827146b1c1cd36.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>    <img src="http://upload-images.jianshu.io/upload_images/2287777-b2c552dfef180bd0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>    2 、在电脑“系统偏好设置”中心打开网络查看本机ip地址，打开手机“设置”-&gt;“无线局域网”，进入选中的网络，HTTP代理选中“手动”。服务器处填写电脑ip地址，端口写8888。设置好后，我们打开iPhone上的任意需要网络通讯的程序，就可以看到Charles弹出请求的确认菜单，单击”Allow”按钮，即可完成设置。<br>    <img src="http://upload-images.jianshu.io/upload_images/2287777-5691a767f7f4c5b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><pre><code>例子：页面![](http://upload-images.jianshu.io/upload_images/2287777-f3aa893eddb3f79c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)抓包图![](http://upload-images.jianshu.io/upload_images/2287777-1b9e8848529d704b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)![](http://upload-images.jianshu.io/upload_images/2287777-be562c35ee4972d2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;一、 下载地址&lt;br&gt;Charles的下载地址：&lt;a href=&quot;https://pan.baidu.com/s/1sl8bE93&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://pan.baidu.com/s/1sl8bE93&lt;/a&gt;&lt;br
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>如何优雅地调试手机网页？</title>
    <link href="http://yoursite.com/2017/10/10/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%9C%B0%E8%B0%83%E8%AF%95%E6%89%8B%E6%9C%BA%E7%BD%91%E9%A1%B5%EF%BC%9F/"/>
    <id>http://yoursite.com/2017/10/10/如何优雅地调试手机网页？/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:49:52.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在web开发的过程中，抓包、调试页面样式、查看请求头是很常用的技巧。其实在iOS开发中，这些技巧也能用（无论是模拟器还是真机），不过我们需要用到mac自带的浏览器Safari。所以，本文将讲解如何使用Safari对iOS程序中的webview进行调试。<br>1、打开真机（模拟器）的开发者模式<br>【设置】-&gt; 【Safari】 -&gt; 【高级】 -&gt; 【Web检查器】打开<br><img src="http://upload-images.jianshu.io/upload_images/2287777-e937adb9c77a3768.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>2、打开MBP上的Safari的开发者模式：<br>【Safari】-&gt;【偏好设置】-&gt;【高级】-&gt; 【在菜单栏中显示“开发”菜单】勾选。<br>3、调试你的WebView页面。<br>4、在MBP的Safari选项中的开发，看到手机，右击可以看到正在调试的WebView的url<br><img src="http://upload-images.jianshu.io/upload_images/2287777-c12eb2da00e79f34.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>5、在弹出的这个框里面可以查看网页源代码以及可以调试样样式、查看localStorage、sessionStorage、Cookie的值等等，给原生端调试带来很大方便，不过这样前端调试更加方便啊，谷歌的模拟器不能完全模真实环境下的iphone使用效果啊。<br><img src="http://upload-images.jianshu.io/upload_images/2287777-4d55fd205fa81cc8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;在web开发的过程中，抓包、调试页面样式、查看请求头是很常用的技巧。其实在iOS开发中，这些技巧也能用（无论是模拟器还是真机），不过我们需要用到mac自带的浏览器Safari。所以，本文将讲解如何使用Safari对iOS程序中的webview进行调
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>1个月实现1个iOS客户端+后台服务端</title>
    <link href="http://yoursite.com/2017/10/10/1%E4%B8%AA%E6%9C%88%E5%AE%9E%E7%8E%B01%E4%B8%AAiOS%E5%AE%A2%E6%88%B7%E7%AB%AF+%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1%E7%AB%AF/"/>
    <id>http://yoursite.com/2017/10/10/1个月实现1个iOS客户端+后台服务端/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:48:23.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hotels"><a href="#Hotels" class="headerlink" title="Hotels"></a>Hotels</h1><p>住哪儿App</p><p><img src="https://github.com/FantasticLBP/Hotels/blob/master/住哪儿/Assets.xcassets/AppIcon.appiconset/11.png?raw=true" alt="AppLogo" title="这是App的Logo"></p><p><strong>实现了类似艺龙App的预定酒店功能，包括酒店搜索、特色酒店推荐、特惠酒店推荐等等功能，可以预定酒店、查看订单，唯独不能支付（支付功能必须由公司的名义注册，个人练手注册不了）。</strong></p><ul>包括iOS开发的常见功能：<br><li>自定义NavigationController实现全屏右滑返回上一控制器的LBPNavigationController</li><br><li>自定义UIScrollView实现全屏滑动显示不同控制器的LBPScrollSegmentView</li><br><li>封装网络访问类AFNetPackage，具备检查网络状态、JSON方式获取数据、xml方式获取数据、post、get、delete、文件下载、文件上传等功能</li><br><li>UITableview上拉加载、下面刷新功能;UITableView潜逃UICollecionView展现界面，事件、数据等通过Delegate处理</li><br><li>Masonry自动布局库的使用</li><br><li>封装好的启动欢迎页</li><br><li>个人信息持久化保存</li><br><li>复杂界面的布局纯代码实现</li><br><li>cell的重用内存优化</li><br><li>自定义URL Schemes便于其他App或者网页唤起；方便App或者网页传递参数</li><br><li>工程结构一幕了然，便于拓展</li><br><li>界面采用代码实现，部分界面采用xib实现。整个代码可读性比较好、代码规范、有注释说明，配合服务端是自己用php写的，Api也是php实现的。</li><br><li>主要功能：根据不同主题查找酒店、摇一摇随机推荐酒店、根据城市定位推荐酒店、根据用户输入多条件模糊搜索查找酒店、酒店位置地图显示、路径规划及其导航（百度地图、高德地图、系统地图）、订单查看等、酒店分享等功能</li><br></ul><h3>效果截图</h3><p><img src="https://raw.githubusercontent.com/FantasticLBP/Hotels/master/1.gif" alt="App效果图" title="这是App的效果图"></p><p>ToDo：后期可能会实现MVVM框架，将RAC技术应用到工程中去。一些容易变的页面采用Html5实现，比如”发现模块”的特色酒店。</p><h3>福利</h3><p></p><p>如果想了解服务端开发以及App与服务端交互（也就是接口开发）可以看看这个App的后台代码。 </p><p></p><h3>住哪儿App的后台管理功能，包括主题酒店、特色酒店发布、注册用户的统计查看、订单的统计查看、酒店的统计查看。Controller目录下的Api下就是给App开发的api。想写api的童鞋们可以看看。</h3><br><ul>包括php系统开发的常见功能：<br><li>复杂表单的提交，包括多图片上传</li><br><li>基于Bootstrap框架的界面布局</li><br><li>封装PDO数据库操作类，实现增删改查等等常见功能，调用简单</li><br><li>随机酒店推荐策略</li><br><li>多条件模糊搜索酒店算法</li><br><li>jquery表格插件Datatables的使用大大丰富了数据的展现方式，更具交互性。具有自动分页、模糊搜索等功能</li><br><li>封装了Response类，可以传递4个参数 show($code, $message = ‘’, $data = array(), $type = self::JSON)来展示json或者array或者xml。</li><br><li>工程结构一幕了然，便于拓展</li><br></ul><br><br><h3>效果截图</h3><p><img src="https://github.com/FantasticLBP/Hotels_Server/blob/master/Systemt_Screen1.png?raw=true" alt="系统截图" title="这是系统截图"></p><p>如果有不懂的地方可以加入QQ交流群讨论：515066271。这个QQ群讨论技术范围包括：iOS、H5混合开发、前端开发、PHP开发，欢迎大家讨论技术。</p><p>最后奉上项目地址，全部开源</p><p><a href="https://github.com/FantasticLBP/Hotels" target="_blank" rel="external">住哪儿App客户端</a></p><p><a href="https://github.com/FantasticLBP/Hotels_Server" target="_blank" rel="external">住哪儿后台服务端</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Hotels&quot;&gt;&lt;a href=&quot;#Hotels&quot; class=&quot;headerlink&quot; title=&quot;Hotels&quot;&gt;&lt;/a&gt;Hotels&lt;/h1&gt;&lt;p&gt;住哪儿App&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/FantasticLB
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>URL-Schemes深度剖析（上）</title>
    <link href="http://yoursite.com/2017/10/10/URL-Schemes%E6%B7%B1%E5%BA%A6%E5%89%96%E6%9E%90%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
    <id>http://yoursite.com/2017/10/10/URL-Schemes深度剖析（上）/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:53:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>###自定义URL Schemes###</p><p>1、引言</p><p>URL Schemes 应用在 iOS 上已经很久了。对于使用者来说，在沙盒机制下的 iOS 中，如果想做到一定程度上的自动化就不可避免地要用到 URL Schemes。但因为 URL Schemes 的使用方式不像传统 iOS 使用者接触到的图形界面那样可以直观地点来点去，造成了对它有兴趣的人（尤其是对英文有恐惧的人）一定程度上理解的困难。</p><p>2、简介苹果的沙盒机制</p><p>苹果选择沙盒来保障用户的隐私和安全，但沙盒也阻碍了应用间合理的信息共享，于是有了 URL Schemes 这个解决办法。</p><p>一般来说，我们使用的智能设备上有许多我们的个人信息。比如：联系方式、银行卡/信用卡信息、支付宝/Paypal/各大商城的账户密码、照片甚至行程与位置信息等。</p><p>如果说，你设备上的每一个应用，不管是官方的还是你从任何商城安装的应用都可以随意地获取这些信息，那么你轻则收到骚扰信息和邮件、重则后果不堪设想。如何让这些信息不被其它应用随意使用，或者说，如何让这些信息仅在设备所有者本人知情并允许的情况下被使用，是所有智能设备与操作系统所要在乎的核心安全问题。</p><p>在 iOS 这个操作系统中，针对这个问题，苹果使用了名为「沙盒」的机制：应用只能访问它声明可能访问的资源。一切提交到 App Store 的应用都必须遵守这个机制。</p><p>在安全方面沙盒是个很好的解决办法，但是有些矫枉过正。敏感的个人信息我们不愿意透露，却不代表所有的信息我们都不想与其它应用共享。</p><p>比如说我们要一次性地（没错，只按一次）把多个事件放到日历中，这些事件包含日期时间以及持续时间等信息，如果 App 之间信息不能沟通，就无法做到这点。（在下文中的 x-callback-URL 的部分会详述整个过程）</p><p>类似于一次性添加多个日历事件这样的，我们在使用智能设备的过程中会遇到很多不必要的重复的步骤。大多数人对这些重复的步骤是不自觉的，就像当自己电脑里有一批文件需要批量重命名的时候，他们机械地重复着重命名的过程。但是当我们掌握了这些设备运行的模式，或者有了一些工具，我们就能将这些重复的步骤全部节省下来。在 iOS 上，我们可以利用的工具就是 URL Schemes。</p><p>3、URL Schemes 是什么</p><p>Custom URL scheme 的好处就是，你可以在其它程序中通过这个url打开应用程序。如Ａ应用程序注册了一个url scheme:myApp, 那么就在mobile浏览器中就可以通过<a href="href=’myApp://’">href=’myApp://’</a>打开你的应用程序Ａ。</p><p>对比网页url就比较好理解url scheme。给出一个url “<a href="http://bxu2359670321.my3w.com/view/login.php”，它的格式：protocol" target="_blank" rel="external">http://bxu2359670321.my3w.com/view/login.php”，它的格式：protocol</a> :// hostname[:port] / path / [;parameters][?query]#fragment。<br>因此这个url的protocol就是http。对比URL Scheme，给出例子“weixin://dl/moments“，前面的weixin:就代表微信的scheme。你可以完全按照理解一个网页的 URL ——也就是它的网址——的方式来理解一个 iOS 应用的 URL。即Scheme是<strong>://</strong>之前的那段字符</p><p>###注意###</p><p>1、所有的网页都有url；但未必所有的应用都有自己的 URL Schemes，更不是每个应用的每个功能都有相应的 URL Schemes</p><p>2、一个网址只对应一个网页，但并非每个 URL Schemes 都只对应一款应用。这点是因为苹果没有对 URL Schemes 有不允许重复的硬性要求</p><p>3、一般网页的 URL 比较好预测，而 iOS 上的 URL Schemes 因为没有统一标准，所以非常难猜，通过猜来获取 iOS 应用的 URL Schemes 是不现实的。（我推荐将Bundle identifier反转） </p><p>###上干货###</p><p>1、注册自定义 URL Scheme</p><p>1）注册自定义 URL Scheme 的第一步是创建 URL Scheme — 在 Xcode Project Navigator 中找到并点击工程 info.plist 文件。当该文件显示在右边窗口，在列表上点击鼠标右键，选择 Add Row:</p><p><img src="http://upload-images.jianshu.io/upload_images/2287777-e22f24acf7823cfa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="url scheme1.png"></p><p>2）点击左边剪头打开列表，可以看到 Item 0，一个字典实体。展开 Item 0，可以看到 URL Identifier，一个字符串对象。该字符串是你自定义的 URL scheme 的名字。建议采用反转Bundle idenmtifier的方法保证该名字的唯一性</p><p><img src="http://upload-images.jianshu.io/upload_images/2287777-67f09fb472c6b87d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="url scheme2.png"></p><p>3）点击 Item 0 新增一行，从下拉列表中选择 URL Schemes，敲击键盘回车键完成插入。（注意 URL Schemes 是一个数组，允许应用定义多个 URL schemes。）展开该数据并点击 Item 0。你将在这里定义自定义 URL scheme 的名字。只需要名字，不要在后面追加 ://</p><p><img src="http://upload-images.jianshu.io/upload_images/2287777-b9c1d5245529fa1b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="url scheme3.png"></p><p>2、拿浏览器坐简单验证</p><p>在地址栏中熟入自定的url scheme。此时必须保证该浏览器所在设备上已经安装了具有自定义url scheme的App。</p><p><img src="http://upload-images.jianshu.io/upload_images/2287777-93cc952da314d7bf.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_5739.PNG"></p><p>3、新建Xcode工程，做个App试试看，这里我就放一个Button，点击打开url<br>代码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (IBAction)open:(id)sender &#123;</div><div class="line">    NSString *url = @&quot;zhunaer://?name=lbp&amp;age=22&quot;;</div><div class="line">    if ([[UIApplication sharedApplication] canOpenURL:[NSURL URLWithString:url]]) &#123;</div><div class="line">           [[UIApplication sharedApplication] openURL:[NSURL URLWithString:url]];</div><div class="line">    &#125;else&#123;</div><div class="line">        NSLog(@&quot;打不开&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>结果打不开，为什么？<br>因为在新建App的plist中没加query schemes</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;key&gt;LSApplicationQueriesSchemes&lt;/key&gt;</div><div class="line">&lt;array&gt;</div><div class="line">&lt;string&gt;zhunaer&lt;/string&gt;</div><div class="line">&lt;/array&gt;</div></pre></td></tr></table></figure><p>4、如果需要在2个App之间传值，怎么办？可以用URL Scheme解决。</p><p>在被打开的App的Appdelegate.m中实现-(BOOL)application:(UIApplication <em>)application openURL:(nonnull NSURL </em>)url sourceApplication:(nullable NSString *)sourceApplication annotation:(nonnull id)annotation；</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">-(BOOL)application:(UIApplication *)application openURL:(nonnull NSURL *)url sourceApplication:(nullable NSString *)sourceApplication annotation:(nonnull id)annotation&#123;</div><div class="line">    NSLog(@&quot;calling application bundle id: %@&quot;,sourceApplication);</div><div class="line">    NSLog(@&quot;url shceme:%@&quot;,[url scheme]);</div><div class="line">    NSLog(@&quot;参数:%@&quot;,[url query]);</div><div class="line">    if ([sourceApplication isEqualToString:@&quot;com.geek.test1&quot;]) &#123;</div><div class="line">        return YES;</div><div class="line">    &#125;</div><div class="line">    return NO;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure><p>在需要打开第三方App的点击事件处的url处后面加上参数，类似NSString *url = @”zhunaer://?name=lbp&amp;age=22”;</p><p>注意：在URL Scheme后加?然后跟网页的url的参数一样写法。</p><p>5、如何判断是指定App打开，或者某些App不让打开我们的App？<br>做了实验。</p><p>A：在需要打开第三方App的工程中将Bundle identifier改为“com.geek.test2”,其余不变</p><p>B：在被打开的App的AppDelegate.m中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-(BOOL)application:(UIApplication *)application openURL:(nonnull NSURL *)url sourceApplication:(nullable NSString *)sourceApplication annotation:(nonnull id)annotation&#123;</div><div class="line">    NSLog(@&quot;calling application bundle id: %@&quot;,sourceApplication);</div><div class="line">    NSLog(@&quot;url shceme:%@&quot;,[url scheme]);</div><div class="line">    NSLog(@&quot;参数:%@&quot;,[url query]);</div><div class="line">    if ([sourceApplication isEqualToString:@&quot;com.geek.test1&quot;]) &#123;</div><div class="line">        return YES;</div><div class="line">    &#125;</div><div class="line">    return NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><img src="http://upload-images.jianshu.io/upload_images/2287777-5ddf86e7d30b1c05.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Simulator Screen Shot 2017年5月1日 下午2.48.21.png"></p><p>###实验结果###</p><p>依旧可以打开App，即使断点走入Return NO</p><p>结论：如果你想阻止其它应用调用你的应用，<strong>创建一个与众不同的 URL scheme</strong>。尽管这不能保证你的应用不会被调用，但至少大大降低了这种可能性。</p><p>参考：<a href="https://sspai.com/post/31500#01" target="_blank" rel="external">https://sspai.com/post/31500#01</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;###自定义URL Schemes###&lt;/p&gt;
&lt;p&gt;1、引言&lt;/p&gt;
&lt;p&gt;URL Schemes 应用在 iOS 上已经很久了。对于使用者来说，在沙盒机制下的 iOS 中，如果想做到一定程度上的自动化就不可避免地要用到 URL Schemes。但因为 URL Sche
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>H5性能优化方面的探索</title>
    <link href="http://yoursite.com/2017/10/10/H5%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%96%B9%E9%9D%A2%E7%9A%84%E6%8E%A2%E7%B4%A2/"/>
    <id>http://yoursite.com/2017/10/10/H5性能优化方面的探索/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:52:26.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="H5性能优化方面的探索"><a href="#H5性能优化方面的探索" class="headerlink" title="H5性能优化方面的探索"></a>H5性能优化方面的探索</h1><blockquote><p>H5很重要，很重要，很重要，重要的事情必须重复多遍，H5的优点：跨平台、迭代快、开发体验好。缺点：加载慢，用户体验差。所以在接下来很长一段时间内我将会从H5的几个缺点发面去研究如何优化。</p></blockquote><p>## </p><h2 id="一、缓存问题及其解决办法"><a href="#一、缓存问题及其解决办法" class="headerlink" title="一、缓存问题及其解决办法"></a>一、缓存问题及其解决办法</h2><p>经常遇到一个问题，H5页面由于缓存问题经常在H5发布新版本之后客户端App看不到最新的效果，之前由于杂七杂八的问题项目工期紧没好好研究，最近抽空研究了下缓存问题。</p><p>缓存问题具体表现为：UIWebview首次打开加载慢；第二次加载速度明显快；H5资源更新过后在App上看不到更改的效果</p><p>为此我认为是缓存造成的问题，我进入App目录下，看到Library下的Caches下面有很多文件名称很长的文件，点击预览可以看到是图片、css等，本来我想着找出H5资源缓存到App中的特点，然后用NSFileManager删除掉缓存文件，发现此路不通。</p><h4 id="我想通过控制变量法研究缓存是否存在。"><a href="#我想通过控制变量法研究缓存是否存在。" class="headerlink" title="我想通过控制变量法研究缓存是否存在。"></a>我想通过控制变量法研究缓存是否存在。</h4><h4 id="做了一个实验。步骤如下："><a href="#做了一个实验。步骤如下：" class="headerlink" title="做了一个实验。步骤如下："></a>做了一个实验。步骤如下：</h4><ul><li>用HBuilder（一个编辑器，开启后本机端口8020就可以访问网页）打开H5工程</li><li>在App的一个UIWebview页面上通过和电脑在同一个局域网的方式加载网页</li><li>在App上查看效果，观察某个元素的样式</li><li>在HBuilder编辑器中修改元素样式</li><li>在App上将UIWebView返回上一界面，再次进入查看该元素的样式</li><li>确定有没有变化，来确定有没有缓存</li></ul><p>结论：页面实时效果变化的，没有缓存</p><p>对比实验：</p><ul><li>用HBuilder（一个编辑器，开启后本机端口8020就可以访问网页）打开H5工程</li><li>git提交到服务端</li><li>在App的一个UIWebview页面上通过公网IP的方式加载网页</li><li>在App上查看效果，观察某个元素的样式</li><li>在HBuilder编辑器中修改元素样式</li><li>git提交后发布到服务器上</li><li>在App上将UIWebView返回上一界面，再次进入查看该元素的样式</li><li>确定有没有变化，来确定有没有缓存</li></ul><p>结论：页面没有看到最新的效果，明显缓存了。但是我很想知道为什么本地局域网的方式请求网页不会缓存，而通过公网IP的方式会缓存。</p><p>为此，我做了进一步的实验，用谷歌浏览器分别请求本地局域网和公网ip查看资源加载的情况。</p><p>1、公网IP<br><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-09-15%20下午5.56.28.png" alt=""></p><p>2、本地局域网</p><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-09-15%20下午6.27.16.png" alt=""></p><p>关键词Status Code</p><p>结论：从图上可以看出本地局域网不管首次加载还是刷新都是直接请求；而通过局域网的方式请求：首次请求是从服务器上获取，在此刷新的时候是从（from memory cache）中获取的。</p><h4 id="猜想"><a href="#猜想" class="headerlink" title="猜想"></a>猜想</h4><p>局域网 的方式网速都比较快所以不会缓存；</p><p>公网IP的方式可能由于网速问题会将首次请求到的资源缓存下来。</p><p>所以确定缓存存在了，那么如何避免缓存？</p><ul><li>App在启动后请求一个接口，这个接口的目的是获取当前H5资源的版本号</li><li>将获得的版本号保存下来（App本地保存）</li><li>由于UIWebView上加载网页，发起网络请求都可以通过一个代理方法所拦截，所以我们可以在这个代理方法中判断url的参数，可能是<a href="http://www.a.com/login、http://www.a.com/login.html、http://www.a.com/login.html?name=geek、http://www.a.com/login#readme等等，所以我们判断过url后考虑如何将版本号加到url里面" target="_blank" rel="external">http://www.a.com/login、http://www.a.com/login.html、http://www.a.com/login.html?name=geek、http://www.a.com/login#readme等等，所以我们判断过url后考虑如何将版本号加到url里面</a></li><li>由于我们的App使用了不同模块的UIWebView，但是都是在UIWebView上需要大量的JS交互，所以使用了WebViewJavascriptBridge这个库。UIWebView本身的代理方法不会执行，所以修改这个库里面的WebViewJavascriptBridge.m文件的代码，差不多是下面的方式</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType &#123;</div><div class="line">    if (webView != _webView) &#123; return YES; &#125;</div><div class="line">    NSURL *url = [rntity Tag 的资源直接访问equest URL];</div><div class="line">    if ([request.URL.absoluteString containsString:@&quot;http&quot;] || [request.URL.absoluteString containsString:@&quot;https&quot;]) &#123;</div><div class="line">        if ([request.URL.absoluteString containsString:@&quot;?&quot;]) &#123;</div><div class="line">            url = [NSURL URLWithString:[NSString stringWithFormat:@&quot;%@&amp;h5V=%@&quot;,request.URL.absoluteString,[ProjectUtil getH5VersionString]]];</div><div class="line">        &#125;else&#123;</div><div class="line">            url = [NSURL URLWithString:[NSString stringWithFormat:@&quot;%@?h5V=%@&quot;,request.URL.absoluteString,[ProjectUtil getH5VersionString]]];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    LBPLOG(@&quot;url-&gt;%@&quot;,[url absoluteString]);</div><div class="line">    __strong WVJB_WEBVIEW_DELEGATE_TYPE* strongDelegate = _webViewDelegate;</div><div class="line">    if ([_base isCorrectProcotocolScheme:url]) &#123;</div><div class="line">        if ([_base isBridgeLoadedURL:url]) &#123;</div><div class="line">            [_base injectJavascriptFile];</div><div class="line">        &#125; else if ([_base isQueueMessageURL:url]) &#123;</div><div class="line">            NSString *messageQueueString = [self _evaluateJavascript:[_base webViewJavascriptFetchQueyCommand]];</div><div class="line">            [_base flushMessageQueue:messageQueueString];</div><div class="line">        &#125; else &#123;</div><div class="line">            [_base logUnkownMessage:url];</div><div class="line">        &#125;</div><div class="line">        return NO;</div><div class="line">    &#125; else if (strongDelegate &amp;&amp; [strongDelegate respondsToSelector:@selector(webView:shouldStartLoadWithRequest:navigationType:)]) &#123;</div><div class="line">        return [strongDelegate webView:webView shouldStartLoadWithRequest:request navigationType:navigationType];</div><div class="line">    &#125; else &#123;</div><div class="line">        return YES;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>总结：</p><p>App的缓存问题暂时研究到这里，后期会继续研究其他方面的问题</p><h1 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h1><p>通过浏览器我们知道有的缓存是200 OK（from cache ），有的缓存是304 Not modified。如果运维移除了Entity Tag就一直是200（from cache）。如果没有移除的话2者是交替出现的。</p><p>为什么2者会有区别？</p><ul><li>200 OK（from cache）是直接点击链接或者在浏览器地址栏中输入网址敲回车键的结果</li><li>而304 modified是我们刷新了浏览器页面时触发或者设置了长缓存、但Entity Tags没有移除时触发</li></ul><p>做了 实验得出结论：</p><ul><li><p>直接访问有缓存的网站都触发 200 OK (from cache)</p></li><li><p>刷新浏览器则会触发304</p></li><li><p>同一域名下，没有 Entity Tag 的资源直接访问，是 200 OK (from cache) 的结果</p></li><li><p>同一域名下，有Entity Tag 的资源直接访问，是出现304 Not Modified</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;H5性能优化方面的探索&quot;&gt;&lt;a href=&quot;#H5性能优化方面的探索&quot; class=&quot;headerlink&quot; title=&quot;H5性能优化方面的探索&quot;&gt;&lt;/a&gt;H5性能优化方面的探索&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;H5很重要，很重要，很重要，重要的事情必须
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>popstate事件在webkit中的诡异行为</title>
    <link href="http://yoursite.com/2017/10/10/popstate%E4%BA%8B%E4%BB%B6%E5%9C%A8webkit%E4%B8%AD%E7%9A%84%E8%AF%A1%E5%BC%82%E8%A1%8C%E4%B8%BA/"/>
    <id>http://yoursite.com/2017/10/10/popstate事件在webkit中的诡异行为/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:53:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>1、背景：同事去学校做毕设请假，今天帮他修改h5bug<br>2、遇到的问题：移动端App打开某个网页会自动弹出一个对话框，这个对话框出现的不合时宜，因为需要是在页面做一些操作后点击原生顶部的返回按钮再弹出对话框<br>3、具体问题就是<strong>popstate</strong>造成的</p><p>4、原来的代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">window.addEventListener(&apos;popstate&apos;, function() &#123;</div><div class="line">var btnArray = [&apos;我要退出&apos;, &apos;继续计数&apos;];</div><div class="line">mui.confirm(&apos;正在计数哦，确定要退出吗？&apos;, &apos;提示&apos;, btnArray, function(e) &#123;</div><div class="line">if(e.index == 1) &#123;</div><div class="line">pushHistory();</div><div class="line">&#125; else &#123;</div><div class="line">setBack();</div><div class="line">&#125;</div><div class="line">&#125;)</div><div class="line">&#125;,false);</div></pre></td></tr></table></figure><p>5、修改后的代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">window.addEventListener(&apos;load&apos;, function() &#123;</div><div class="line">setTimeout(function() &#123;</div><div class="line">window.addEventListener(&apos;popstate&apos;, function() &#123;</div><div class="line">var btnArray = [&apos;我要退出&apos;, &apos;继续计数&apos;];</div><div class="line">mui.confirm(&apos;正在计数哦，确定要退出吗？&apos;, &apos;提示&apos;, btnArray, function(e) &#123;</div><div class="line">if(e.index == 1) &#123;</div><div class="line">pushHistory();</div><div class="line">&#125; else &#123;</div><div class="line">setBack();</div><div class="line">&#125;</div><div class="line">&#125;)</div><div class="line">&#125;);</div><div class="line">&#125;, 0);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>6、暂且先解决问题，日后有时间继续深入研究</p><p>研究一阵</p><p>7、说说过去</p><p>以前浏览器操作浏览器历史记录主要依据history对象。在它的<em>proto</em>继承有back、forward、go等函数，那么什么是popState？<strong>简而言之就是HTML5新增的用来控制浏览器历史记录的api。</strong></p><p>8、怎么用？</p><p>HTML5的新API扩展了window.history，使历史记录点更加开放了。可以存储当前历史记录点pushState、替换当前历史记录点replaceState、监听历史记录点popstate。</p><p>history.pushState(data,title,url);<br>//其中第一个参数data是给state的值；第二个参数title为页面的标题，但当前所有浏览器都忽略这个参数，传个空字符串就好；第三个参数url是你想要去的链接；</p><p>replaceState用法类似，例如：history.replaceState(“首页”,””,location.href+ “#web”);</p><p>两者区别：pushState会改变history.length，而replaceState不改变history.length</p><p>9、有坑吗？</p><p>popstate事件在webkit中的很诡异。popstate是HTML5的History系列中的事件，但是这玩意儿在webkit中的行为相当让人蛋疼。这回连IE10都站在了Firefox这边，至少这边的实用性强的多。虽然官方的文档中对popstate的描述也没有细节上的描述，不过以我的逻辑来判断，这货是就webkit的BUG。</p><p>Html5这套ApI和传统的history不同，或者说这套API是“session history entries”。</p><p>注意注意：Html5种的HistoryAPI是不会使页面跳转的，只是操作地址栏和相应的state属性而已，而且它是手动操作的。浏览器默认的History还是传统的那一套，虽然它们在浏览器上都使用同一个“历史记录堆栈”。</p><p>对这个差异的认知就是webkit中诡异行为的原因。webkit并没有把HTML5的History和传统的区分开，而根据官方文档对popstate的描述，只要访问历史记录就会触发popstate。而传统的History中访问页面和生产历史记录是同时的。所以在webkit中，无论是刷新还是访问一个新网页都会触发popstate。而其它浏览器中这个popstate仅作用于HTML5的History，并不响应传统的History，更不用说刷新和访问新网页的情况了。</p><p>原因找到了，那么解决方案呢？</p><p>1、对popstate延迟绑定的方法，因为popstate会在页面加载完成之后不久触发，所以在setTimeout一段时间后再绑定事件，popstate的第一次就不会轻易被webkit夺走了<br>2、判断浏览器再做调整，直接针对webkit在页面加载完成后第一次触发的popstate屏蔽了</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;1、背景：同事去学校做毕设请假，今天帮他修改h5bug&lt;br&gt;2、遇到的问题：移动端App打开某个网页会自动弹出一个对话框，这个对话框出现的不合时宜，因为需要是在页面做一些操作后点击原生顶部的返回按钮再弹出对话框&lt;br&gt;3、具体问题就是&lt;strong&gt;popstate&lt;/s
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>-last-child与-last-of-type你只是会用，有研究过区别吗？</title>
    <link href="http://yoursite.com/2017/10/10/-last-child%E4%B8%8E-last-of-type%E4%BD%A0%E5%8F%AA%E6%98%AF%E4%BC%9A%E7%94%A8%EF%BC%8C%E6%9C%89%E7%A0%94%E7%A9%B6%E8%BF%87%E5%8C%BA%E5%88%AB%E5%90%97%EF%BC%9F/"/>
    <id>http://yoursite.com/2017/10/10/-last-child与-last-of-type你只是会用，有研究过区别吗？/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:48:04.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="last-child与-last-of-type"><a href="#last-child与-last-of-type" class="headerlink" title=":last-child与:last-of-type"></a>:last-child与:last-of-type</h1><blockquote><p>同学们遇到过给同一组元素的最后一个元素设置css失效的情况吗？我遇到过，当时使用:last-child居然不起作用，看到名字不科学啊，明明是“最后一个元素”，那为什么设置CSS失效呢？今天来一探究竟吧</p></blockquote><ul><li>先看一组<code>:last-child</code>正常工作的代码</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line"></div><div class="line">    &lt;head&gt;</div><div class="line">        &lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">        &lt;title&gt;:last-child、:last-of-type&lt;/title&gt;</div><div class="line">        &lt;script src=&quot;../../lib/jquery-2.1.0.js&quot;&gt;&lt;/script&gt;</div><div class="line">        &lt;style&gt;</div><div class="line">            ul &#123;</div><div class="line">                margin: 100px 0;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            li &#123;</div><div class="line">                list-style: circle;</div><div class="line">                border-bottom: 1px solid #000000;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            li:last-child &#123;</div><div class="line">                border-color: red;</div><div class="line">            &#125;</div><div class="line">        &lt;/style&gt;</div><div class="line"></div><div class="line">    &lt;/head&gt;</div><div class="line"></div><div class="line">    &lt;body&gt;</div><div class="line">        &lt;ul&gt;</div><div class="line">            &lt;li&gt;1&lt;/li&gt;</div><div class="line">            &lt;li&gt;2&lt;/li&gt;</div><div class="line">            &lt;li&gt;3&lt;/li&gt;</div><div class="line">            &lt;!--&lt;p&gt;我是来骚扰的&lt;/p&gt;--&gt;</div><div class="line">        &lt;/ul&gt;</div><div class="line">    &lt;/body&gt;</div><div class="line"></div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/FantasticLBP/web/master/assets/屏幕快照%202017-06-17%20下午4.56.03.png" alt="效果图1" title="效果图1"></p><ul><li>再先看一组<code>:last-child</code>不正常工作的代码</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line"></div><div class="line">    &lt;head&gt;</div><div class="line">        &lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">        &lt;title&gt;:last-child、:last-of-type&lt;/title&gt;</div><div class="line">        &lt;script src=&quot;../../lib/jquery-2.1.0.js&quot;&gt;&lt;/script&gt;</div><div class="line">        &lt;style&gt;</div><div class="line">            ul &#123;</div><div class="line">                margin: 100px 0;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            li &#123;</div><div class="line">                list-style: circle;</div><div class="line">                border-bottom: 1px solid #000000;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            li:last-child &#123;</div><div class="line">                border-color: red;</div><div class="line">            &#125;</div><div class="line">        &lt;/style&gt;</div><div class="line"></div><div class="line">    &lt;/head&gt;</div><div class="line"></div><div class="line">    &lt;body&gt;</div><div class="line">        &lt;ul&gt;</div><div class="line">            &lt;li&gt;1&lt;/li&gt;</div><div class="line">            &lt;li&gt;2&lt;/li&gt;</div><div class="line">            &lt;li&gt;3&lt;/li&gt;</div><div class="line">            &lt;p&gt;我是来骚扰的&lt;/p&gt;</div><div class="line">        &lt;/ul&gt;</div><div class="line">    &lt;/body&gt;</div><div class="line"></div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure><p><img src="https://github.com/FantasticLBP/web/blob/master/assets/屏幕快照%202017-06-17%20下午4.57.23.png?raw=true" alt="效果图2" title="效果图2"></p><p>问题抛出来了，那么来研究下:last-child和:last-of-type究竟是何方神圣。</p><ol><li><p>:last-child：<strong>The last-child CSS pseudo-class represents the last element among a group of sibling elements.（:last-child这个css伪类代表的一组兄弟元素当中最后一个元素）但经过代码发现，它说的一组元素应该是指其父元素的所有子元素且类型为:last-child前面指定的类型的一组元素。</strong></p></li><li><p>:last-of-type：<strong>The last-of-type CSS pseudo-class represents the last element of its type among a group of sibling elements.（</strong>:last-of-type这个css伪类代表其类型的一组兄弟元素中的最后一个元素<strong>）所以它指的是和</strong>:last-of-type前面的元素类型一致的一组元素的最后一个元素</p></li></ol><p>同理：:nth-last-child和:nth-last-of-type的区别在于父元素的子元素中且与:nth-last-child前面的元素类型一致的最后一个元素</p><p>做个验证</p><ul><li>:nth-last-child可以正常工作的代码</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">&lt;title&gt;:last-child、:last-of-type&lt;/title&gt;</div><div class="line">&lt;script src=&quot;../../lib/jquery-2.1.0.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;style&gt;</div><div class="line">ul &#123;</div><div class="line">margin: 100px 0;</div><div class="line">&#125;</div><div class="line"></div><div class="line">li &#123;</div><div class="line">list-style: circle;</div><div class="line">border-bottom: 1px solid #000000;</div><div class="line">&#125;</div><div class="line">li:nth-last-child(1)&#123;</div><div class="line">border-color: red;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&lt;/style&gt;</div><div class="line"></div><div class="line">&lt;/head&gt;</div><div class="line"></div><div class="line">&lt;body&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">&lt;li&gt;1&lt;/li&gt;</div><div class="line">&lt;li&gt;2&lt;/li&gt;</div><div class="line">&lt;li&gt;3&lt;/li&gt;</div><div class="line">&lt;!--&lt;p&gt;我是来骚扰的&lt;/p&gt;--&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&lt;/body&gt;</div><div class="line"></div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure><p><img src="https://github.com/FantasticLBP/web/blob/master/assets/屏幕快照%202017-06-17%20下午5.25.01.png?raw=true" alt="效果图3" title="效果图3"></p><ul><li>:nth-last-child不能正常工作的代码</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"> &lt;html&gt;</div><div class="line"> &lt;head&gt;</div><div class="line"> &lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line"> &lt;title&gt;:last-child、:last-of-type&lt;/title&gt;</div><div class="line"> &lt;script src=&quot;../../lib/jquery-2.1.0.js&quot;&gt;&lt;/script&gt;</div><div class="line"> &lt;style&gt;</div><div class="line"> ul &#123;</div><div class="line"> margin: 100px 0;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> li &#123;</div><div class="line"> list-style: circle;</div><div class="line"> border-bottom: 1px solid #000000;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"></div><div class="line"> li:nth-last-child(1)&#123;</div><div class="line"> border-color: red;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> &lt;/style&gt;</div><div class="line"></div><div class="line"> &lt;/head&gt;</div><div class="line"></div><div class="line"> &lt;body&gt;</div><div class="line"> &lt;ul&gt;</div><div class="line"> &lt;li&gt;1&lt;/li&gt;</div><div class="line"> &lt;li&gt;2&lt;/li&gt;</div><div class="line"> &lt;li&gt;3&lt;/li&gt;</div><div class="line"> &lt;p&gt;我是来骚扰的&lt;/p&gt;</div><div class="line"> &lt;/ul&gt;</div><div class="line"> &lt;/body&gt;</div><div class="line"></div><div class="line"> &lt;/html&gt;</div></pre></td></tr></table></figure><p><img src="https://github.com/FantasticLBP/web/blob/master/assets/屏幕快照%202017-06-17%20下午4.57.23.png?raw=true" alt="效果图2" title="效果图2"></p><ul><li>接下来:nth-last-of-type闪亮登场</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">&lt;title&gt;:last-child、:last-of-type&lt;/title&gt;</div><div class="line">&lt;script src=&quot;../../lib/jquery-2.1.0.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;style&gt;</div><div class="line">ul &#123;</div><div class="line">margin: 100px 0;</div><div class="line">&#125;</div><div class="line"></div><div class="line">li &#123;</div><div class="line">list-style: circle;</div><div class="line">border-bottom: 1px solid #000000;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">li:nth-last-of-type(1)&#123;</div><div class="line">border-color: red;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&lt;/style&gt;</div><div class="line"></div><div class="line">&lt;/head&gt;</div><div class="line"></div><div class="line">&lt;body&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">&lt;li&gt;1&lt;/li&gt;</div><div class="line">&lt;li&gt;2&lt;/li&gt;</div><div class="line">&lt;li&gt;3&lt;/li&gt;</div><div class="line">&lt;p&gt;我是来骚扰的&lt;/p&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&lt;/body&gt;</div><div class="line"></div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure><p><img src="https://github.com/FantasticLBP/web/blob/master/assets/屏幕快照%202017-06-17%20下午5.25.01.png?raw=true" alt="效果图3" title="效果图3"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;last-child与-last-of-type&quot;&gt;&lt;a href=&quot;#last-child与-last-of-type&quot; class=&quot;headerlink&quot; title=&quot;:last-child与:last-of-type&quot;&gt;&lt;/a&gt;:last-child与:
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>在内存剖析对象</title>
    <link href="http://yoursite.com/2017/10/10/%E5%9C%A8%E5%86%85%E5%AD%98%E5%89%96%E6%9E%90%E5%AF%B9%E8%B1%A1/"/>
    <id>http://yoursite.com/2017/10/10/在内存剖析对象/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:50:42.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="对象在内存中的存储"><a href="#对象在内存中的存储" class="headerlink" title="对象在内存中的存储"></a>对象在内存中的存储</h1><ul><li><p>栈、堆、BSS、数据段、代码段是什么？</p><ul><li><p>栈（stack）：又称作堆栈，用来存储程序的局部变量（但不包括static声明的变量，static修饰的数据存放于数据段中）。除此之外，在函数被调用时，栈用来传递参数和返回值。</p></li><li><p>堆（heap）：用于存储程序运行中被动态分配的内存段，它的大小并不固定，可动态的扩张和缩减。操作函数(malloc／free)</p></li><li><p>BSS段（bss segment）：通常用来存储程序中未被初始化的全局变量和静态变量的一块内存区域。BSS是英文Block Started by Symbol的简称。BSS段输入静态内存分配</p></li><li><p>数据段（data segment）：通常用来存储程序中已被初始化的全局变量和静态变量和字符串的一块内存区域</p></li><li><p>代码段（code segment）：通常是指用来存储程序可执行代码的一块内存区域。这部分区域的大小在程序运行前就已经确定，并且内存区域通常属于只读，某些架构也允许代码段为可写，即允许修改程序。在代码段中，也有可能包含一些只读的常数变量，例如字符串常量。</p></li></ul></li></ul><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/内存.png" alt="内存" title="内存"></p><ul><li><h5 id="搞清楚上面的概念再来研究下对象在内存中如何存储？"><a href="#搞清楚上面的概念再来研究下对象在内存中如何存储？" class="headerlink" title="搞清楚上面的概念再来研究下对象在内存中如何存储？"></a>搞清楚上面的概念再来研究下对象在内存中如何存储？</h5></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Person *p1 = [Person new]</div></pre></td></tr></table></figure><p>看这行代码，先来看几个注意点：</p><ul><li><p>new底层做的事情：</p><ul><li><p>在堆内存中申请1块合适大小的空间</p></li><li><p>在这块内存上根据类模版创建对象。类模版中定义了什么属性就依次把这些属性声明在对象中；对象中还存在一个属性叫做<strong>isa</strong>，是一个指针，指向对象所属的类在代码段中地址</p></li><li><p>初始化对象的属性。这里初始化有几个原则：a、如果属性的数据类型是基本数据类型则赋值为0；b、如果属性的数据类型是C语言的指针类型则赋值为NULL；c、如果属性的数据类型为OC的指针类型则赋值为nil。</p></li><li><p>返回堆空间上对象的地址</p></li></ul></li><li><p>注意</p><ul><li><p>对象只有属性，没有方法。包括类本身的属性和一个指向代码段中的类isa指针</p></li><li><p>如何访问对象的属性？指针名-&gt;属性名；本质：根据指针名找到指针指向的对象，再根据属性名查找来访问对象的属性值</p></li><li><p>如何调用方法？[指针名 方法];本质：根据指针名找到指针指向的对象，再发现对象需要调用方法，再通过对象的isa指针找到代码段中的类，再调用类里面方法</p></li></ul></li><li><p>为什么不把方法存储在对象中？</p><ul><li><p>因为以类为模版创建的对象只有属性可能不相同，而方法相同，如果堆区的对象里面也保存方法的话就会很重复，浪费了堆空间，因此将方法存储与代码段</p></li><li><p>所以一个类创建的n个对象的isa指针的地址值都相同，都指向代码段中的类地址</p></li></ul></li></ul><p><strong>做个小实验</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line">@interface Person : NSObject&#123;</div><div class="line">    @public</div><div class="line">    int _age;</div><div class="line">    NSString *_name;</div><div class="line">    int *p;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)sayHi;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation Person</div><div class="line"></div><div class="line">-(void)sayHi&#123;</div><div class="line">    NSLog(@&quot;Hi, %@&quot;,_name);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">int main(int argc, const char * argv[]) &#123;</div><div class="line">    Person *p1 = [Person new];</div><div class="line">    Person *p2 = [Person new];</div><div class="line">    Person *p3 = [Person new];</div><div class="line">    p1-&gt;_age = 20;</div><div class="line">    p2-&gt;_age = 20;</div><div class="line"></div><div class="line">    [p1 sayHi];</div><div class="line">    [p2 sayHi];</div><div class="line">    [p3 sayHi];</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Person  *p1 = [Person new];</div></pre></td></tr></table></figure><p><strong>这句代码在内存分配原理如下图所示</strong></p><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/Untitled%20Diagram-2.png" alt="p1" title="p1"></p><p><strong>结论</strong></p><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-05-15%20下午5.35.17.png" alt="p1" title="p1"></p><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-05-15%20下午5.35.34.png" alt="p3" title="p3"></p><p><strong>可以 看到Person类的3个对象p1、p2、p3的isa的值相同。</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;对象在内存中的存储&quot;&gt;&lt;a href=&quot;#对象在内存中的存储&quot; class=&quot;headerlink&quot; title=&quot;对象在内存中的存储&quot;&gt;&lt;/a&gt;对象在内存中的存储&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;栈、堆、BSS、数据段、代码段是什么？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>外卖App双列表联动</title>
    <link href="http://yoursite.com/2017/10/10/%E5%A4%96%E5%8D%96App%E5%8F%8C%E5%88%97%E8%A1%A8%E8%81%94%E5%8A%A8/"/>
    <id>http://yoursite.com/2017/10/10/外卖App双列表联动/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:50:09.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="双列表联动"><a href="#双列表联动" class="headerlink" title="双列表联动"></a>双列表联动</h3><blockquote><p>用过了那么多的外卖App，总结出一个规律，那就是“所有的外卖App都有双列表联动功能”。哈哈哈哈，这是一个玩笑。</p><p>这次我也需要开发具有联动效果的双列表。也是首次开发这种类型的UI，记录下步骤与心得</p></blockquote><h4 id="一、关键思路"><a href="#一、关键思路" class="headerlink" title="一、关键思路"></a>一、关键思路</h4><ul><li>懒加载左右2个UITableView</li><li>根据需要自定义Cell</li><li>2个UITableView加载到界面上的时候注意下部剧就好</li><li>因为需要联动效果，所有左侧的UITableView一般是大的分类，右边的UITableView一般是大分类小的小分类，所以有了这样的特点<ul><li>左边的UITableView是只有1个section和n个row</li><li>右边的UITableView具有n个section（这里的section 个数恰好是左边UITableView的row数量），且每个section下的row由对应的数据源控制</li></ul></li></ul><h4 id="二、第一版代码"><a href="#二、第一版代码" class="headerlink" title="二、第一版代码"></a>二、第一版代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">#pragma mark -- UITableViewDelegate</div><div class="line">-(NSInteger)numberOfSectionsInTableView:(UITableView *)tableView&#123;</div><div class="line">    if (tableView == self.leftTablview) &#123;</div><div class="line">        return 1;</div><div class="line">    &#125;</div><div class="line">    return self.datas.count;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section&#123;</div><div class="line">    if (tableView == self.leftTablview) &#123;</div><div class="line">        return self.datas.count;</div><div class="line">    &#125;</div><div class="line">    QuestionCollectionModel *model = self.datas[section];</div><div class="line">    NSArray *questions =model.questions;</div><div class="line">    return questions.count;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath&#123;</div><div class="line">    if (tableView == self.leftTablview) &#123;</div><div class="line">        return LeftCellHeight;</div><div class="line">    &#125;</div><div class="line">    return RightCellHeight;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath&#123;</div><div class="line">    if (tableView == self.leftTablview) &#123;</div><div class="line">        PregnancyPeriodCell *cell = [tableView dequeueReusableCellWithIdentifier:PregnancyPeriodCellID forIndexPath:indexPath];</div><div class="line">        if (self.collectionType == CollectionType_Wrong || self.collectionType == CollectionType_Miss) &#123;</div><div class="line">            QuestionCollectionModel *model = self.datas[indexPath.row];</div><div class="line">            cell.week = model.tag;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return cell;</div><div class="line">    &#125;</div><div class="line">    QuestionCell *cell = [tableView dequeueReusableCellWithIdentifier:QuestionCellID forIndexPath:indexPath];</div><div class="line">    QuestionCollectionModel *model = self.datas[indexPath.section];</div><div class="line">    NSArray *questions =model.questions;</div><div class="line">    QuestionModel *questionModel = questions[indexPath.row];</div><div class="line">    cell.model = questionModel;</div><div class="line">    return cell;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath&#123;</div><div class="line">    if (tableView == self.leftTablview) &#123;</div><div class="line">        NSIndexPath *indexpath = [NSIndexPath indexPathForRow:0 inSection:indexPath.row];</div><div class="line">        [self.rightTableview scrollToRowAtIndexPath:indexpath atScrollPosition:UITableViewScrollPositionTop animated:YES];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)scrollViewDidScroll:(UIScrollView *)scrollView&#123;</div><div class="line">    if (scrollView == self.rightTableview) &#123;</div><div class="line">        NSIndexPath *indexpath = [self.rightTableview indexPathsForVisibleRows].firstObject;</div><div class="line">        NSIndexPath *leftScrollIndexpath = [NSIndexPath indexPathForRow:indexpath.section inSection:0];</div><div class="line">        [self.leftTablview selectRowAtIndexPath:leftScrollIndexpath animated:YES scrollPosition:UITableViewScrollPositionMiddle];</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>缺陷：虽然实现了效果，但是有缺陷。点击左侧的UITableView，右侧的UITableViewe滚动到相应的位置，这是没问题的，但是滚动</p><p>右边，需要根据右边indexPath.section将选中左侧相应的indexPath。这样左侧选中的时候，又会触发右边滚动的事件，整体看上去不是很流畅。</p><h4 id="三、解决方案"><a href="#三、解决方案" class="headerlink" title="三、解决方案"></a>三、解决方案</h4><p>观察了下，发现右侧滚动的时候左侧会上下选中，所以也就是只要让右侧滚动的时候，左侧的UITableView单方向选中，不要滚动就好，所以由于UITableView也是UIScrollview，所以在scrollViewDidScroll方法中判断右侧的UITableView是向上还是向下滚动，以此作为判断条件来让左侧的UITableView选中相应的行。</p><p>且之前是在scrollview代理方法中让左侧的tableview选中，这样子又会触发左侧tableview的选中事件，从而导致右侧的tablview滚动，造成不严谨的联动逻辑</p><p>改进后的方法：</p><ol><li><p>点击左侧的UITableView，在代理方法didSelectRowAtIndexPath中拿到相应的indexPath.row，计算出右侧UITableView需要滚动的indexPath的位置。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[self.rightTableview scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:0 inSection:indexPath.row] atScrollPosition:UITableViewScrollPositionTop animated:YES];</div></pre></td></tr></table></figure></li><li><p>在willDisplayCell和didEndDisplayingCell代理方法中选中左侧UITableView相应的行。</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">-(void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath&#123;</div><div class="line"></div><div class="line">    if (tableView == self.rightTableview  &amp;&amp; !self.isScrollDown &amp;&amp; self.rightTableview.isDragging ) &#123;</div><div class="line">        [self.leftTablview selectRowAtIndexPath:[NSIndexPath indexPathForRow:indexPath.section inSection:0] animated:YES scrollPosition:UITableViewScrollPositionTop];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">-(void)tableView:(UITableView *)tableView didEndDisplayingCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath&#123;</div><div class="line">    if (tableView == self.rightTableview &amp;&amp; self.isScrollDown &amp;&amp; self.rightTableview.isDragging) &#123;</div><div class="line">        [self.leftTablview selectRowAtIndexPath:[NSIndexPath indexPathForRow:indexPath.section+1 inSection:0] animated:YES scrollPosition:UITableViewScrollPositionTop];</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(nonnull NSIndexPath *)indexPath</div><div class="line">&#123;</div><div class="line">    if (self.leftTablview == tableView)</div><div class="line">    &#123;</div><div class="line">        [self.rightTableview scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:0 inSection:indexPath.row] atScrollPosition:UITableViewScrollPositionTop animated:YES];</div><div class="line">    &#125;else&#123;</div><div class="line">        NSLog(@&quot;嗡嗡嗡&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">#pragma mark - UIScrollViewDelegate</div><div class="line"></div><div class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView&#123;</div><div class="line"></div><div class="line">    static CGFloat lastOffsetY = 0;</div><div class="line"></div><div class="line">    UITableView *tableView = (UITableView *)scrollView;</div><div class="line">    if (self.rightTableview == tableView)&#123;</div><div class="line">        self.isScrollDown = (lastOffsetY &lt; scrollView.contentOffset.y);</div><div class="line">        lastOffsetY = scrollView.contentOffset.y;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><h5 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h5><p> <img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/2017-09-24%2015_35_52.gif" alt="效果图" title="效果图"></p><p>附上Demo：<a href="https://github.com/FantasticLBP/BlogDemos" target="_blank" rel="external">Demo</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;双列表联动&quot;&gt;&lt;a href=&quot;#双列表联动&quot; class=&quot;headerlink&quot; title=&quot;双列表联动&quot;&gt;&lt;/a&gt;双列表联动&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;用过了那么多的外卖App，总结出一个规律，那就是“所有的外卖App都有双列表联动功能”。哈
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>NSFileManager终极杀手个App接口</title>
    <link href="http://yoursite.com/2017/10/10/NSFileManager%E7%BB%88%E6%9E%81%E6%9D%80%E6%89%8B/"/>
    <id>http://yoursite.com/2017/10/10/NSFileManager终极杀手/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:53:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="NSFileManager"><a href="#NSFileManager" class="headerlink" title="NSFileManager"></a>NSFileManager</h1><blockquote><p>想操作文件，该去了解下NSFileManager</p></blockquote><p>注意：//小窍门：打印数组或者字典，里面包含中文，直接用%@打印会看不到中文，可用for遍历访问</p><ul><li>单例方法得到文件管理者对象</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSFileManager *fileManager = [NSFileManager defaultManager];</div></pre></td></tr></table></figure><ul><li>判断是否存在指定的文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#define LogBool(value) NSLog(@&quot;%@&quot;,value==YES?@&quot;YES&quot;:@&quot;NO&quot;);</div><div class="line"></div><div class="line">   NSString *filepath = @&quot;/Users/geek/Desktop/data.plist&quot;;</div><div class="line">   BOOL res = [fileManager fileExistsAtPath:filepath];</div><div class="line">   LogBool(res)</div></pre></td></tr></table></figure><ul><li>根据给出的文件路径判断是否存在文件，且判断路径是文件还是文件夹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">NSString *filepath1 = @&quot;/Users/geek/Desktop/data.plist&quot;;</div><div class="line">    BOOL isDirectory = NO;</div><div class="line">    BOOL isExist =  [fileManager fileExistsAtPath:filepath1 isDirectory:&amp;isDirectory];</div><div class="line">    if (isExist) &#123;</div><div class="line">        NSLog(@&quot;文件存在&quot;);</div><div class="line">        if (isDirectory) &#123;</div><div class="line">            NSLog(@&quot;文件夹路径&quot;);</div><div class="line">        &#125;else&#123;</div><div class="line">            NSLog(@&quot;文件路径&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;else&#123;</div><div class="line">        NSLog(@&quot;给定的路径不存在&quot;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure><ul><li>判断文件或者文件夹是否可以读取</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//这是一个系统文件（不可读）</div><div class="line"> NSString *filePath2 = @&quot;/.DocumentRevisions-V100 &quot;;</div><div class="line"> BOOL isReadable = [fileManager isReadableFileAtPath:filePath2];</div><div class="line"> if (isReadable) &#123;</div><div class="line">     NSLog(@&quot;文件可读取&quot;);</div><div class="line"> &#125; else &#123;</div><div class="line">     NSLog(@&quot;文件不可读取&quot;);</div><div class="line"> &#125;</div></pre></td></tr></table></figure><ul><li>判断文件是否可以写入</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//系统文件不可写入</div><div class="line">   BOOL isWriteAble =  [fileManager isWritableFileAtPath:filePath2];</div><div class="line">   if (isWriteAble) &#123;</div><div class="line">       NSLog(@&quot;文件可写入&quot;);</div><div class="line">   &#125; else &#123;</div><div class="line">       NSLog(@&quot;文件不可写入&quot;);</div><div class="line">   &#125;</div></pre></td></tr></table></figure><ul><li>判断文件是否可以删除</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//系统文件不可删除</div><div class="line">   BOOL isDeleteAble =  [fileManager isDeletableFileAtPath:filePath2];</div><div class="line">    if (isDeleteAble) &#123;</div><div class="line">        NSLog(@&quot;文件可以删除&quot;);</div><div class="line">    &#125; else &#123;</div><div class="line">        NSLog(@&quot;文件不可删除&quot;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure><ul><li>获取文件信息<br><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-07-02%20下午5.58.38.png" alt="文件信息" title="文件信息"></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> NSError *error = nil;</div><div class="line">    NSDictionary *fileInfo =  [fileManager attributesOfItemAtPath:filepath1 error:&amp;error];</div><div class="line">//    NSLog(@&quot;文件信息:%@,错误信息:%@&quot;,fileInfo,error);</div><div class="line">    NSLog(@&quot;文件大小:%@&quot;,fileInfo[NSFileSize]);</div></pre></td></tr></table></figure><ul><li>获取指定目录下的所有目录（列出所有的文件和文件夹）</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">NSString *filePath3 = @&quot;/Users/geek/desktop&quot;;</div><div class="line">    NSArray *subs = [fileManager subpathsAtPath:filePath3];</div><div class="line">    NSLog(@&quot;Desktop目录下所有的所有文件和文件夹&quot;);</div><div class="line">    //小窍门：打印数组或者字典，里面包含中文，直接用%@打印会看不到中文，可用for遍历访问</div><div class="line">    for (NSString *item in subs) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;,item);</div><div class="line">    &#125;</div></pre></td></tr></table></figure><ul><li>获取指定目录下的子目录和文件（不包含子孙）</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">NSError *erroe = nil;</div><div class="line">    NSArray *children =  [fileManager contentsOfDirectoryAtPath:filePath3 error:&amp;erroe];</div><div class="line">    NSLog(@&quot;Desktop目录下的文件和文件夹&quot;);</div><div class="line">    for (NSString *item in children) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;,item);</div><div class="line">    &#125;</div></pre></td></tr></table></figure><ul><li>在指定目录创建文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">NSString *filePath1 = @&quot;/Users/geek/Desktop/data.text&quot;;</div><div class="line">NSData *data = [@&quot;我要学好OC&quot; dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line">BOOL createFile =  [fileManager createFileAtPath:filePath1 contents:data attributes:nil];</div><div class="line">if (createFile) &#123;</div><div class="line">    NSLog(@&quot;文件创建成功&quot;);</div><div class="line">&#125; else &#123;</div><div class="line">    NSLog(@&quot;文件创建失败&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>在指定目录创建文件夹（参数说明：withIntermediateDirectories后的参数为Bool代表。YES：一路创建；NO：不会做一路创建）</li></ul><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-07-02%20下午7.02.53.png" alt="正常创建文件夹成功" title="正常创建文件夹成功"><br><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-07-02%20下午7.07.55.png" alt="创建文件夹失败" title="创建文件夹失败"></p><p>设置一路创建为NO，如果文件夹不存在则停止创建文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">NSString *filePath2 = @&quot;/Users/geek/Desktop/海贼王&quot;;</div><div class="line">NSError *error = nil;</div><div class="line">BOOL createDirectory = [fileManager createDirectoryAtPath:filePath2 withIntermediateDirectories:NO attributes:nil error:&amp;error];</div><div class="line">if (createDirectory) &#123;</div><div class="line">    NSLog(@&quot;文件夹创建成功&quot;);</div><div class="line">&#125; else &#123;</div><div class="line">    NSLog(@&quot;文件夹创建失败，原因：%@&quot;,error);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">//一路创建失败（文件夹不存在就不创建）</div><div class="line">  NSString *filePath3 = @&quot;/Users/geek/Desktop/海贼王&quot;;</div><div class="line">BOOL createDirectory1 = [fileManager createDirectoryAtPath:filePath3 withIntermediateDirectories:NO attributes:nil error:&amp;error];</div><div class="line">if (createDirectory1) &#123;</div><div class="line">    NSLog(@&quot;文件夹创建成功&quot;);</div><div class="line">&#125; else &#123;</div><div class="line">    NSLog(@&quot;文件夹创建失败，原因：%@&quot;,error);</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>复制文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">NSString *filePath4 = @&quot;/Users/geek/Desktop/动漫&quot;;</div><div class="line"></div><div class="line"> BOOL copyRes = [fileManager copyItemAtPath:filePath3 toPath:filePath4 error:nil];</div><div class="line"> if (copyRes) &#123;</div><div class="line">     NSLog(@&quot;文件复制成功&quot;);</div><div class="line"> &#125; else &#123;</div><div class="line">     NSLog(@&quot;文件复制失败&quot;);</div><div class="line"> &#125;</div></pre></td></tr></table></figure><ul><li>移动文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">NSString *filePath5 = @&quot;/Users/geek/Downloads/动漫&quot;;</div><div class="line">  BOOL moveRes = [fileManager moveItemAtPath:filePath3 toPath:filePath5 error:nil];</div><div class="line">  if (moveRes) &#123;</div><div class="line">      NSLog(@&quot;文件移动成功&quot;);</div><div class="line">  &#125; else &#123;</div><div class="line">      NSLog(@&quot;文件移动失败&quot;);</div><div class="line">  &#125;</div></pre></td></tr></table></figure><ul><li>可以给文件重命名</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//可以给文件重命名</div><div class="line">   NSString *filePath6 = @&quot;/Users/geek/Downloads/卡通&quot;;</div><div class="line">   [fileManager moveItemAtPath:filePath5 toPath:filePath6 error:nil];</div></pre></td></tr></table></figure><ul><li>删除文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">BOOL deleteRes = [fileManager removeItemAtPath:filePath6 error:nil];</div><div class="line">if (deleteRes) &#123;</div><div class="line">    NSLog(@&quot;文件删除成功&quot;);</div><div class="line">&#125; else &#123;</div><div class="line">    NSLog(@&quot;文件删除失败&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h1 id="NSFileManager小病毒"><a href="#NSFileManager小病毒" class="headerlink" title="NSFileManager小病毒"></a>NSFileManager小病毒</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">//单例方法得到文件管理者对象</div><div class="line">   NSFileManager *fileManager = [NSFileManager defaultManager];</div><div class="line">   NSString *filePath = @&quot;/Users/geek/desktop/delete/&quot;;</div><div class="line">   while (1) &#123;</div><div class="line">       //判断该文件路径是否存在</div><div class="line">       BOOL exist = [fileManager fileExistsAtPath:filePath];</div><div class="line">       if (exist) &#123;</div><div class="line">           //找出该路径下的所有文件</div><div class="line">           NSArray *subs = [fileManager contentsOfDirectoryAtPath:filePath error:nil];</div><div class="line">           if (subs.count &gt; 0) &#123;</div><div class="line">               for (int i=0; i&lt;subs.count; i++) &#123;</div><div class="line">                   NSString *fullFileStr = [NSString stringWithFormat:@&quot;%@%@&quot;,filePath,subs[i]];</div><div class="line">                   //判断文件是否可删除</div><div class="line">                   BOOL canDelete = [fileManager isDeletableFileAtPath:fullFileStr];</div><div class="line">                   if (canDelete) &#123;</div><div class="line">                       [fileManager removeItemAtPath:fullFileStr error:nil];</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       //5秒钟为周期，开始不断扫描文件并删除</div><div class="line">       [NSThread sleepForTimeInterval:5];</div><div class="line">   &#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;NSFileManager&quot;&gt;&lt;a href=&quot;#NSFileManager&quot; class=&quot;headerlink&quot; title=&quot;NSFileManager&quot;&gt;&lt;/a&gt;NSFileManager&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;想操作文件，该去了解下NS
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>开始hexo博客之旅</title>
    <link href="http://yoursite.com/2017/10/10/%E5%BC%80%E5%A7%8Bhexo%E5%8D%9A%E5%AE%A2%E4%B9%8B%E6%97%85/"/>
    <id>http://yoursite.com/2017/10/10/开始hexo博客之旅/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-13T03:55:20.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="首先列一下关键的几个步骤，网站的教程特别多。要看的自己搜一搜"><a href="#首先列一下关键的几个步骤，网站的教程特别多。要看的自己搜一搜" class="headerlink" title="首先列一下关键的几个步骤，网站的教程特别多。要看的自己搜一搜"></a>首先列一下关键的几个步骤，网站的教程特别多。要看的自己搜一搜</h3><p>1、下载安装node环境<br>2、本机配置git环境<br>3、node安装hexo环境<br>4、下载自己细化的主题，我选择的是next主题<br>5、更改next主题文件夹下的 _config.yml 文件，做一些常用设置的更改<br>6、开始写文章，格式采用markdown语法，写完后发布一下 hexo d</p><h3 id="开启订阅"><a href="#开启订阅" class="headerlink" title="开启订阅"></a>开启订阅</h3><p>1、下载安装hexo插件 npm install hexo-generator-feed –save<br>2、修改根目录_config.yml配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># RSS</div><div class="line">plugin: hexo-generator-feed</div><div class="line">#Feed Atom</div><div class="line">feed:</div><div class="line">type: atom</div><div class="line">path: atom.xml</div><div class="line">limit: 20</div></pre></td></tr></table></figure></p><p>3、修改主题_config.yml配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rss: /atom.xml</div></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;首先列一下关键的几个步骤，网站的教程特别多。要看的自己搜一搜&quot;&gt;&lt;a href=&quot;#首先列一下关键的几个步骤，网站的教程特别多。要看的自己搜一搜&quot; class=&quot;headerlink&quot; title=&quot;首先列一下关键的几个步骤，网站的教程特别多。要看的自己搜一搜&quot;&gt;
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>工程大小优化之图片资源</title>
    <link href="http://yoursite.com/2017/10/10/%E5%B7%A5%E7%A8%8B%E5%A4%A7%E5%B0%8F%E4%BC%98%E5%8C%96%E4%B9%8B%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90/"/>
    <id>http://yoursite.com/2017/10/10/工程大小优化之图片资源/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:48:40.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="工程大小优化之图片资源"><a href="#工程大小优化之图片资源" class="headerlink" title="工程大小优化之图片资源"></a>工程大小优化之图片资源</h3><blockquote><p><em>摘要：</em>点点iOS项目本身功能较多，导致应用体积也比较大。一个Xcode工程下图片资源占用了很大的空间，且如果有些App需要一键换肤功能，呵呵，不知道得做多少图片。每套图片还需要设置1x@,2x@,3x@等</p></blockquote><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>IconFont技术起源于Web领域的Web Font技术。随着时间的推移，网页设计越来越漂亮。但是电脑预装的字体远远无法满足设计者的要求，于是Web Font技术诞生了。一个英文字库并不大，通过网络下载字体，完成网页的显示。有了Web Font技术，大大提升了设计师的发挥空间。</p><p>网页设计中图标需要适配多个分辨率，每个图标需要占用一次网络请求。于是有人想到了用Web Font的方法来解决这两个问题，就是IconFont技术。将矢量的图标做成字体，一次网络请求就够了，可以保真缩放。解决这个问题的另一个方式是图片拼合的Sprite图。</p><p>Web领域使用IconFont类似的技术已经多年，当我在15年接触BootStrap的时候Font Awesome技术大行其道。最近IconFont技术在iOS图片资源方面得以应用，最近有点时间自己研究整理了一番，在此记录学习点滴。</p><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ul><li>减小体积，字体文件比图片要小</li><li>图标保真缩放，解决2x/3x乃至将来的nx图问题</li><li>方便更改颜色大小，图片复用</li></ul><h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ul><li>只适用于<br><code>纯色icon</code></li><li>使用unicode字符难以理解</li><li>需要维护字体库</li></ul><p>网上说了一大堆如何制作IconFont的方法，在此不做讨论。</p><h2 id="我们说说怎么用"><a href="#我们说说怎么用" class="headerlink" title="我们说说怎么用"></a>我们说说怎么用</h2><ol><li>首先选取一些有丰富资源的网站，我使用阿里的IconFont多年，其他的没去研究，所以此处直接使用阿里的产品。地址：<a href="http://www.iconfont.cn/plus" target="_blank" rel="external">http://www.iconfont.cn/plus</a></li><li>打开网站在线挑选好合适的图标加入购物车，如图<img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-05-28%20下午2.43.33.png" alt="阿里IconFont" title="阿里IconFont"></li><li>选择好之后在购物车查看，然后点击下载代码<img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-05-28%20下午2.43.48.png" alt="下载IconFont" title="下载IconFont"></li><li>打开下载好的文件，其机构如下，我们在iOS项目开发过程中使用unicode的形式使用IconFont,所以打开demo_unicode.html<br><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-05-28%20下午2.44.09.png" alt="下载文件目录结构" title="下载文件目录结构"><br><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-05-28%20下午2.44.22.png" alt="unicode形式使用IconFont" title="unicode形式使用IconFont"></li><li>注意：创建 UIFont 使用的是字体名，而不是文件名；文本值为 8 位的 Unicode 字符，我们可以打开 demo.html 查找每个图标所对应的 HTML 实体 Unicode 码，比如： “店” 对应的 HTML 实体 Unicode 码为：0x3439 转换后为：\U00003439 就是将 0x 替换为 \U 中间用 0 填补满长度为 8 个字符</li></ol><h1 id="Xcode中使用IconFont"><a href="#Xcode中使用IconFont" class="headerlink" title="Xcode中使用IconFont"></a>Xcode中使用IconFont</h1><p>初步尝试使用</p><ol><li>首先看看如何简单实用IconFont</li><li>首先将下载好的文件夹中的<strong>iconfont.ttf</strong>加入到Xcode工程中，确保加入成功在Build检查<img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-05-28%20下午2.51.36.png" alt="Xcode检查引入结果" title="Xcode检查引入结果"></li><li>怎么用？</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">NSMutableAttributedString *attributedStr = [[NSMutableAttributedString alloc] initWithString:@&quot;\U0000e696  \U0000e6ab  \U0000e6ac  \U0000e6ae&quot;];</div><div class="line">    [attributedStr addAttribute:NSForegroundColorAttributeName value:[UIColor redColor] range:NSMakeRange(0, 1)];</div><div class="line">    [attributedStr addAttribute:NSForegroundColorAttributeName value:[UIColor orangeColor] range:NSMakeRange(3, 1)];</div><div class="line">    [attributedStr addAttribute:NSForegroundColorAttributeName value:[UIColor blackColor] range:NSMakeRange(9, 1)];</div><div class="line">    self.label.attributedText = attributedStr;</div><div class="line"></div><div class="line">[self.view addSubview:self.label];</div><div class="line"></div><div class="line">pragma mark - getter and setter</div><div class="line">-(UILabel *)label&#123;</div><div class="line">       if (!_label) &#123;</div><div class="line">           _label = [[UILabel alloc] initWithFrame:CGRectMake(100, 100, BoundWidth-200, 40)];</div><div class="line">           _label.font = [UIFont fontWithName:@&quot;iconfont&quot; size:24];</div><div class="line">           _label.textColor = [UIColor purpleColor];</div><div class="line">       &#125;</div><div class="line">       return _label;</div><div class="line">   &#125;</div></pre></td></tr></table></figure><h4 id="做进一步封装，实用更加方便"><a href="#做进一步封装，实用更加方便" class="headerlink" title="做进一步封装，实用更加方便"></a>做进一步封装，实用更加方便</h4><p>利用IconFont生成1个UIImage只需要<strong>LBPIconFontmake(par1, par2, par3)</strong>，par1:iconfont的unicode值；par2:图片大小；par3:图片的颜色值。</p><p>其中，LBPIconFontmake是一个宏，#define LBPIconFontmake(text,size,color) [[LBPFontInfo alloc] initWithText:text withSize:size andColor:color]。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">self.latestImageView.image = [UIImage iconWithInfo:LBPIconFontmake(@&quot;\U0000e6ac&quot;, 60, @&quot;000066&quot;) ];</div></pre></td></tr></table></figure><p><img src="https://github.com/FantasticLBP/iOSKonwledge-Kit/raw/master/assets/屏幕快照%202017-05-28%20下午2.56.00.png" alt="封装后的工程目录结构" title="封装后的工程目录结构"></p><ol><li>LBPFontInfo来封装字体信息</li><li>UIColor+picker根据十六进制字符串来设置颜色</li><li>LBPIconFont向系统中注册IconFont字体库，并使用</li><li>UIImage+LBPIconFont封装一个使用IconFont的Image分类</li></ol><h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/Simulator%20Screen%20Shot%202017年5月28日%20下午3.19.44.png" alt="效果图" title="效果图"></p><h1 id="Demo地址"><a href="#Demo地址" class="headerlink" title="Demo地址"></a>Demo地址</h1><p><a href="https://github.com/FantasticLBP/IconFont_Demo" target="_blank" rel="external">https://github.com/FantasticLBP/IconFont_Demo</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;工程大小优化之图片资源&quot;&gt;&lt;a href=&quot;#工程大小优化之图片资源&quot; class=&quot;headerlink&quot; title=&quot;工程大小优化之图片资源&quot;&gt;&lt;/a&gt;工程大小优化之图片资源&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;摘要：&lt;/em&gt;点点iOS项目本身
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>iOS程序员利用分页和模糊查询技术实现一个App接口</title>
    <link href="http://yoursite.com/2017/10/10/iOS%E7%A8%8B%E5%BA%8F%E5%91%98%E5%88%A9%E7%94%A8%E5%88%86%E9%A1%B5%E5%92%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAApp%E6%8E%A5%E5%8F%A3/"/>
    <id>http://yoursite.com/2017/10/10/iOS程序员利用分页和模糊查询技术实现一个App接口/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:52:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>摘要: 模糊查询技术、分页技术、App接口</p><p>1、分页问题</p><pre><code>关键技术点：php执行sql语句。示例：“SELECT * FROM hotel WHERE subject=&apos;10&apos; and address like &apos;%杭州%&apos; LIMIT 0,4”。注意：LIMIT后需要跟2个数字，1个是起始位置，2是结束位置。</code></pre><p>   可以对limit函数进行封装：select <em>from user limit (page-1)</em>size,page*size;</p><pre><code>单例模式编写App接口的注意点：（1）、php后台获取参数，之后根据参数转换成SQL语句；（2）、php执行SQL语句，将结果转换成JSON，返回给客户端</code></pre><p>2、模糊搜索</p><pre><code>SQL匹配模式（开发中应用最多的一种）：</code></pre><p>   （1）、使用SQL匹配模式，不能使用操作符 = 或 != ，而是使用操作符LIKE或者NOT LIKE</p><p>   （2）、使用SQL匹配模式，MySQL提供了2种通配符。</p><pre><code>%:表示任意数量的任意字符（包括0个）_:表示任意的单个字符例子：u_name为“张三”，“张猫三”、“三脚猫”，“唐三藏”。如果要找回包含“三”和“猫”的纪录     “select *from user where u_name LIKE &apos;%三%&apos; and u_name LIKE &apos;%猫%&apos;;     若使用“select *from user where u_name LIKE &apos;%三%猫%&apos;;”只能找出：三脚猫</code></pre><p>   （3）、使用SQL匹配模式，如果匹配格式当中不包含以上2种通配符中的任意1个，其查询效果等同于= 或 !=</p><p>   （4）、使用SQL匹配模式，默认情况下是不区分大小写的</p><p>   正则表达式匹配模式（不推荐）：</p><pre><code>（1）、 []:表示括号内所列字符中的一个：指定一个字符、字符串或范围，要求所匹配对象为它们中的任意一个    比如 SELECT * FROM [user] WHERE u_name LIKE &apos;[张李王]三&apos;。将找出“张三”、“李三”、“王三”（而不是“张李王三”）；    比如[ ] 内有一系列字符（01234、abcde之类的）则可略写为“0-4”、“a-e”。SELECT * FROM [user] WHERE u_name LIKE &apos;老[1-9]&apos;-&gt; 将找出“老1”、“老2”、……、“老9”；（2）、[^]:表示不在括号所列之内的单个字符。其取值和[]相同，要求匹配对象为指定字符以外的任意一个字符  比如 SELECT * FROM [user] WHERE u_name LIKE &apos;[^张李王]三&apos;。将找出不姓“张”、“李”、“王”的“赵三”、“孙三”等</code></pre><p>  （3）、.:匹配任意的单个字符</p><p>   （4）、^:表示以某个字符或字符串开头。^a:以a开头</p><p>   （5）、$:表示以某个字符或字符串结尾。s$:以s结尾</p><p>   （6）、*:匹配0个或多个在它前面的字符</p><p>使用正则表达式匹配的操作符是：REGEXP和NOT REGEXP（RLIKE或NOT RLIKE）</p><p>注意啊：正则表达式和SQl匹配模式工作原理不一样：正则只要匹配出符合条件就马上算成功；而SQl需要严格匹配。比如同样需要写从酒店表中拿出地址中包含“杭州”的酒店</p><p>SQL:SELECT *FROM hotel WHERE address LIKE ‘%杭州%’;</p><p>正则：SELECT <em>FROM hotel WHERE address REGEXP ‘^[杭][州]</em>’;</p><p>需要特别注意的是：如果所查询的内容包含通配符时，导致我们查询”%”,”_”,”[“的语句无法正常实现。因此我们需要特殊处理。</p><p>需要特别注意的是：如果所查询的内容包含通配符时，导致我们查询”%”,”_”,”[“的语句无法正常实现。因此我们需要特殊处理。</p><pre><code>function sql_encode($sql){  $sql = replace($sql,&quot;[&quot;,&quot;[[]&quot;);  $sql = replace($sql,&quot;%&quot;,&quot;[%]&quot;);  $sql = replace($sql,&quot;_&quot;,&quot;[_]&quot;);  return $sql;}</code></pre><p>最后贴一个利用模糊查询实现分页查询的接口。</p><pre><code>&lt;?php/** * Created by PhpStorm. * User: geek * Date: 2017/2/20 * Time: 上午9:15 */header(&apos;content-type:text.html;charset=utf-8&apos;);error_reporting(0);require_once &apos;../../model/PdoMySQL.class.php&apos;;require_once &apos;../../model/config.php&apos;;require_once &apos;Response.php&apos;;class HotelList{    private $tableName = &quot;hotel&quot;;    private $telephone = &quot;&quot;;    private $cityName= &quot;&quot;;    private $subjectId = &quot;&quot;;    private $page = 0;    private $size = 0;    protected static $_instance = null;    protected function  __construct()    {    }    protected function  __clone()    {        // TODO: Implement __clone() method.    }    public function  getInstance()    {        if (self::$_instance === null) {            self::$_instance = new self();        }        return self::$_instance;    }    function getHotels()    {        self.$this-&gt;telephone = $_REQUEST[&quot;telephone&quot;];        self.$this-&gt;subjectId = $_REQUEST[&quot;subjectId&quot;];        self.$this-&gt;cityName = $_REQUEST[&quot;cityName&quot;];        self.$this-&gt;page = $_REQUEST[&quot;page&quot;];        self.$this-&gt;size = $_REQUEST[&quot;size&quot;];        $mysqlPdo = new PdoMySQL();        if($this-&gt;telephone == &quot;&quot;){            Response::show(201,&quot;fail&quot;,&quot;非安全的数据请求&quot;,&quot;json&quot;);        }        $userRows = $mysqlPdo-&gt;find(&quot;user&quot;,&quot;telephone=&apos;$this-              &gt;telephone&apos;&quot;);        if($userRows[0][&quot;telephone&quot;] != $this-&gt;telephone){            Response::show(201,&quot;fail&quot;,&quot;非安全的数据请求&quot;,&quot;json&quot;);        }        $city = str_replace(&quot;市&quot;,&quot;&quot;,$this-&gt;cityName);        $allrows = $mysqlPdo-&gt;find($this-&gt;tableName,&quot;subject=&apos;$this-&gt;subjectId&apos; and address like &apos;%$city%&apos;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,[(intval($this-&gt;page)-1)*intval($this-&gt;size),intval($this-&gt;page)*intval($this-&gt;size)]);        Response::show(200,&apos;酒店列表获取成功&apos;,$allrows,&apos;json&apos;);    }}$lister = HotelList::getInstance();$lister-&gt;getHotels();</code></pre><p>其中：Respone和PdoMySQL的2个类分别是接口数据展示的类和PDO操作的一个封装。</p><p>如果有需要请留下邮箱。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;摘要: 模糊查询技术、分页技术、App接口&lt;/p&gt;
&lt;p&gt;1、分页问题&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;关键技术点：php执行sql语句。示例：“SELECT * FROM hotel WHERE subject=&amp;apos;10&amp;apos; and address like
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>看透构造方法</title>
    <link href="http://yoursite.com/2017/10/10/%E7%9C%8B%E9%80%8F%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95/"/>
    <id>http://yoursite.com/2017/10/10/看透构造方法/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:49:23.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h1><ul><li><p>new方法的内部就是先调用alloc方法，再调用init方法</p><ul><li><p>alloc方法：那个类接受alloc消息，那么该方法返回该接受类的对象，并把对象返回</p></li><li><p>init方法：是1个对象方法，作用：初始化对象</p></li></ul></li><li><p>创建对象的步骤：先使用alloc创建1个对象，再使用init初始化这个对象，才可以使用这个对象</p><ul><li>使用1个未被初始化的对象是很危险的</li></ul></li><li><p>init方法：作用：初始化对象，为对象赋初始值，叫做构造方法</p></li></ul><h1 id="重写init构造方法"><a href="#重写init构造方法" class="headerlink" title="重写init构造方法"></a>重写init构造方法</h1><ul><li><p>如果想创建出来的对象的属性值不是默认的初始化值，则需要重写init方法</p></li><li><p>重写init方法的规范：</p><ul><li><p>必须要先调用父类的init方法（因为当前类初始化就是通过`[父类init]`去初始化），然后将返回值赋值给self</p></li><li><p>调用init方法有可能会失败，如果失败直接返回nil</p></li><li><p>判断父类是否初始化成功。如果self != nil，则代表初始化成功</p></li><li><p>如果初始化成功就去初始化当前对象的属性</p></li><li><p>最后返回self</p></li></ul></li></ul><h4 id="解惑："><a href="#解惑：" class="headerlink" title="解惑："></a>解惑：</h4><ol><li>为什么要调用父类的init方法？<ol><li>当前类有isa指针，当前类的isa指针赋值是通过父类的init方法赋值的。</li><li>需要保证当前对象的父类属性同时被初始化</li></ol></li><li>重写init方法的规范：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">-(instancetype)init&#123;</div><div class="line">    if (self = [super init]) &#123;</div><div class="line">        //todo：自定义属性的初始化</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">//Person</div><div class="line"></div><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@interface Person : NSObject</div><div class="line">@property NSString* name;</div><div class="line">@property int age;</div><div class="line"></div><div class="line">-(void)sayHi;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">#import &quot;Person.h&quot;</div><div class="line">@implementation Person</div><div class="line"></div><div class="line">-(void)sayHi&#123;</div><div class="line">    NSLog(@&quot;Hi&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(instancetype)init&#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self) &#123;</div><div class="line">        self.name = @&quot;杭城小刘&quot;;</div><div class="line">        self.age = 22;</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line">//测试</div><div class="line"></div><div class="line"> Person *p1 = [[Person alloc] init];    //p1.name = &quot;杭城小刘&quot;，p1.age =22;</div><div class="line"> Person *p2 = [Person new];             //p2.name = &quot;杭城小刘&quot;，p2.age =22;</div></pre></td></tr></table></figure><p>如果2个类的关系为组合关系，且它的一个属性是另一个类的对象，那么当该类初始化的时候默认它的属性为nil，那么如何初始化？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">-(instancetype)init&#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self) &#123;</div><div class="line">        self.name = @&quot;lbp&quot;;</div><div class="line">        self.age = 22;</div><div class="line">        self.pig = [[Pig alloc] init];</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//测试</div><div class="line">  Person *p1 = [[Person alloc] init];        //p1.dog != nil</div></pre></td></tr></table></figure><h1 id="自定义构造方法"><a href="#自定义构造方法" class="headerlink" title="自定义构造方法"></a>自定义构造方法</h1><ul><li><p>现状：虽然每次双肩的对象的属性值不是默认的，但是每次初始化的对象的值都是一样的。</p></li><li><p>需求：每次实例化的对象的属性值由调用者决定</p></li><li><p>解决办法：自定义构造方法</p></li><li><p>自定义构造方法规范：</p><ul><li><p>自定义构造方法的返回值为instancetype</p></li><li><p>方法的命名必须以initWith开头</p></li><li><p>方法的实现类似init的实现</p></li></ul></li></ul><p><strong>注意：此时不能使用new来调用。（因为new的实现是先alloc再init，默认init的实现是给属性赋默认值）</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-(instancetype)initWithName:(NSString *)name andAge:(int)age&#123;</div><div class="line">    if (self = [super init]) &#123;</div><div class="line">        self.name = name;</div><div class="line">        self.age = age;</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">//Person</div><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line">@interface Person : NSObject</div><div class="line">@property NSString* name;</div><div class="line">@property int age;</div><div class="line"></div><div class="line">-(instancetype)initWithName:(NSString *)name andAge:(int)age;</div><div class="line">@end</div><div class="line"></div><div class="line">#import &quot;Person.h&quot;</div><div class="line">@implementation Person</div><div class="line"></div><div class="line">-(instancetype)init&#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self) &#123;</div><div class="line">        self.name = @&quot;lbp&quot;;</div><div class="line">        self.age = 22;</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//不能在构造方法之外给self赋值</div><div class="line">//编译器认为只有以initWith开头的方法是构造方法</div><div class="line"></div><div class="line">-(instancetype)initWithName:(NSString *)name andAge:(int)age&#123;</div><div class="line">    if (self = [super init]) &#123;</div><div class="line">        self.name = name;</div><div class="line">        self.age = age;</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line">//测试</div><div class="line"></div><div class="line">Person *p1 = [[Person alloc] init];</div><div class="line">Person *p2 = [Person new];    </div><div class="line">Person *p3 = [[Person alloc] initWithName:@&quot;杭城小刘2号&quot; andAge:23];</div></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-05-23-5-56-53.png" alt="init" title="init"></p><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-05-23-5-57-08.png" alt="init" title="init"></p><p>关于“自定义构造方法必须以initWith开头”做个实验</p><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-05-23-6-01-29.png" alt="initwith" title="initwith"></p><p>报错信息很明显：不能在构造方法之外给self赋值</p><p>因为，编译器认为只有以initWith开头的方法是构造方法</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;构造方法&quot;&gt;&lt;a href=&quot;#构造方法&quot; class=&quot;headerlink&quot; title=&quot;构造方法&quot;&gt;&lt;/a&gt;构造方法&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;new方法的内部就是先调用alloc方法，再调用init方法&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;alloc方
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
  <entry>
    <title>接口要怎么对？你知道正确的姿势吗</title>
    <link href="http://yoursite.com/2017/10/10/%E6%8E%A5%E5%8F%A3%E8%A6%81%E6%80%8E%E4%B9%88%E5%AF%B9%EF%BC%9F%E4%BD%A0%E7%9F%A5%E9%81%93%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%A7%BF%E5%8A%BF%E5%90%97/"/>
    <id>http://yoursite.com/2017/10/10/接口要怎么对？你知道正确的姿势吗/</id>
    <published>2017-10-10T06:04:27.000Z</published>
    <updated>2017-10-10T06:49:08.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>今天后台同事去温州出差，自己又多了一次远程协作办公的经历-对接口</p></blockquote><h1 id="1、背景"><a href="#1、背景" class="headerlink" title="1、背景"></a>1、背景</h1><p>我在公司主要做iOS和h5开发，懂点php开发（独立开发过一个完整的项目，写的了SQL、写的了接口、写的了后台）。</p><p>对接口的时候前端h5页面已经完成，开始了接口对接工作，但是接口对接并不是那么顺利，负责接口的人是一位“颇有”经验老司机，他看上去28左右的样子（小子我22）</p><h1 id="2、事情经过"><a href="#2、事情经过" class="headerlink" title="2、事情经过"></a>2、事情经过</h1><p>我写好ajax去请求数据发现这次对接并不是很友善。</p><ul><li>起初显示跨域访问，为了方便我让他后端设置运行跨域访问，因为没必要限制访问（加了Access-Control-Allow-Origin:*)</li><li>后来发现返回的数据并不和善，里面携带了大量的html标签，设置了“dataType:json”页面回调走入error里面</li><li>跟他叙述了事情经过居然说他用浏览器测试发现在页面上显示的数据是正常的，肯定是我接收数据解析出错</li><li>在下不服，我要跟你撕逼（讲道理）</li><li>这是我的观点“接口写好<strong>看的不是浏览器上的结果</strong>，要看<strong>response</strong>，你写的接口是要返回给c端或者b端的人去解析，再去展示，不是直接解析到浏览器上的“</li><li>再抛出一个我自己写的接口给他举例子</li></ul><h1 id="3、附图"><a href="#3、附图" class="headerlink" title="3、附图"></a>3、附图</h1><p><img src="https://raw.githubusercontent.com/FantasticLBP/iOSKonwledge-Kit/master/assets/屏幕快照%202017-06-07%20下午3.21.18.png" alt="接口1" title="接口1"></p><p><img src="https://github.com/FantasticLBP/iOSKonwledge-Kit/blob/master/assets/屏幕快照%202017-06-07%20下午3.21.182.png?raw=true" alt="接口2" title="接口2"><br><img src="https://github.com/FantasticLBP/iOSKonwledge-Kit/blob/master/assets/屏幕快照%202017-06-07%20下午3.21.183.png?raw=true" alt="接口3" title="接口3"></p><h1 id="4、启发"><a href="#4、启发" class="headerlink" title="4、启发"></a>4、启发</h1><p>广大开发者朋友们，做开发不管是web还是客户端开发网络知识以及基本的调试知识一定要有，遇到问题一层层排除定位再去解决。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;今天后台同事去温州出差，自己又多了一次远程协作办公的经历-对接口&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;1、背景&quot;&gt;&lt;a href=&quot;#1、背景&quot; class=&quot;headerlink&quot; title=&quot;1、背景&quot;&gt;&lt;/a&gt;1、背景&lt;/h
      
    
    </summary>
    
    
      <category term="home" scheme="http://yoursite.com/tags/home/"/>
    
  </entry>
  
</feed>
